<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts</title>

    <meta name="description" content="Good poem">

    <meta name="generator" content="Hugo 0.72.0" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Posts">
    <meta name="twitter:description" content="Good poem">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Posts">
    <meta property="og:description" content="Good poem">
    <meta property="og:image" content="https://avatars1.githubusercontent.com/u/6533008?s=460&amp;v=4" />

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href="https://pankona.github.io/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="make clean; make" href="https://pankona.github.io/atom.xml" />

    <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://pankona.github.io">make clean; make</a></h1>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/@pankona"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/pankona "><i class="fa fa-github-alt"></i> GitHub</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://pankona.github.io/atom.xml"><i class="fa fa-rss"></i> RSS</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="https://pankona.github.io/categories"></i> Categories</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <div class="content-subhead">2020-09-07 22:09:53</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/09/07/gaming-pc-on-gcp-2/">GCP 上にゲーミング PC をこさえて少し運用してみたら毎月およそ 3,000 円 だよ</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-GCP" href="https://pankona.github.io/categories/gcp">GCP</a><a class="post-category post-category-ゲーム" href="https://pankona.github.io/categories/%E3%82%B2%E3%83%BC%E3%83%A0">ゲーム</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="/blog/2020/06/30/gaming-pc-on-gcp/">GCP 上にゲーミング PC をこさえてみたが 2 日で 800 円だよ</a> という記事のその後。</p>
<p>先述の記事は 2020-06-30 に書いた。<br>
この記事を書いている今日が 2020-09-07 であるので、つまり 2 ヶ月ほど ゲーミング PC on GCP を使ってみたことになる。ちょっと途中経過を書いておく。</p>
<h2 id="tldr">TL;DR</h2>
<p>2020-08 のゲーミング PC on GCP のお値段は、<strong>およそ 12 時間 30 分起動で、3,096 円</strong> だった。</p>
<br>
以下、諸々いじったところとか所感とか。
<h2 id="プレイ時間を計測する仕組みを作った">プレイ時間を計測する仕組みを作った</h2>
<p>どれくらい使うとどれくらいのお値段になるのかしら？というのが知りたかったのであるが、「どれだけ GCE が起動していたか」というメトリックスをとるための機能が GCP にはなさそうに見えた (あったらごめん)。</p>
<p>なので、Cloud Functions と Cloud Pub/Sub と Cloud Scheduler を合わせて、「毎分 GCE に稼働状態を問い合わせて RUNNING だったら記録する君」をこしらえた。保存先は Datastore 。</p>
<div style="max-width: 500px">
  <a href=https://github.com/pankona/gce-vm-launcher><img src=/images/gce-vm-launcher.png /></a>
</div>
<h2 id="ストレージを小さくした">ストレージを小さくした</h2>
<p>それはそうと、2020-07 の段階では 500 GB くらいのストレージを扱うように設定していた。昨今のゲームはインストールするだけでもそれなりに容量食うからね、等と思いつつ。<br>
その後同僚に教えてもらって気付いたのだけれども、このストレージを維持するというのがそれなりに (個人にとっては) 高額で、500 GB のストレージだと維持費が一日あたり 100 円くらいになってしまう。<br>
これはつまり一ヶ月が 30 日あるならばストレージを維持するだけで 3,000 円かかってしまうことになる。お高い。</p>
<p>なので、その後ストレージの容量を減らして 100 GB で運用していくようにしてみた。これなら一日およそ 20 円くらい。一ヶ月 30 日あるならば 600 円。ま、まあこれくらいなら？</p>
<p>正直 100 GB だとそれなりのゲームを 2、3 本いれたらカツカツになってしまうことは目に見えているので、「主にやるゲーム」を選定してそうでないものはアンインストールしておくみたいな運用になりそうな…。</p>
<h2 id="プリエンプティブやめた">プリエンプティブやめた</h2>
<p>当初はお値段の関係からプリエンプティブ (つまりいきなり VM が死ぬのを許容する代わりにお値段が安いモード) でやっていたのだが、思ったより結構落ちる (一日一回は落ちていた気がする) ことが分かってきて結構ストレスだった。<br>
ひとりプレイなゲームならまだしも、マルチプレイしていると「あーごめーん落ちたわー、すぐ戻るから待っててー」などのコミュニケーションが発生してしまい、これはなかなかね、なかなか無理という感じでした。<br>
プリエンプティブで運用するのは無理と判断して、いったん普通のインスタンスに変えてみた。プリエンプティブと比べたら倍以上ランニングコスト高いんだけどやむなし。</p>
<h2 id="そんなわけで-2020-08-の結果">そんなわけで 2020-08 の結果</h2>
<p>2020-07 の当初はストレージ容量 500 GB でやってたみたいなところもあり、一回お値段の計算としてはノーカン扱いとした (ちなみに 3,600 円くらいだった)。<br>
ということで 2020-08 にあらためて一ヶ月運用してみたところ、結果としては、</p>
<p><strong>およそ 12 時間 30 分起動で、3,096 円</strong></p>
<p>というお値段に。<br>
ストレージとか Windows のライセンスフィーとかである程度の固定費があるため、単純にプレイ時間でお値段を割り算しても単位時間あたりのお値段にはならないのだが、とはいえおよそで言うならば <strong>一時間あたり 300 円弱</strong> みたいなお値段だろうか。</p>
<h2 id="高い安い">高い？安い？</h2>
<p>毎月 3,000 円の費用ならば 3 年程度でおよそ 10 万円という感じなので、10 万円のゲーミング PC を買って 3 年後に買い換える、みたいなことを考えるならばトントンなのかもしれない。<br>
ただこれは「毎月 12 時間程度のプレイ時間に抑えられるならば」という条件付きなので、まあもうちょっとちゃんとゲームする人ならば全然ペイしないというか、素直にゲーミング PC 買ったほうがいいわね…。 うむ…。<br>
逆にライトなゲーマーであれば、自作 PC をこさえるよりは安くあがる可能性がないわけではなさそう。まあそれでも毎月 3,000 円はちょっと苦しいか。</p>
<p>なにより、プレイ中に「俺はいまお金を消費しているぞ…」というような強迫観念が脳みそを占めてしまい、ゲームに集中できないという重大な欠点があったりする (感じ方には個人差があるだろうけれども)。</p>
<h2 id="もう少し続けてみる">もう少し続けてみる</h2>
<p>ただ、ゲーミング PC をこさえる予定がない (家庭内稟議を乗り越えられない) という我が家の事情に鑑みて、もう少しこの仕組みで粘っていこうと思う。ちょうど楽しみにしていた <a href="https://store.steampowered.com/app/1307550/Craftopia/?l=japanese">Craftopia</a> が発売したばかりであるし。</p>
<p>なんだかんだいって「PC を置く場所を考えなくてよい」「ストレージが故障したりしない」みたいな要素は快適ではある。つまり早く GeForce Now のラインナップが充実してくれるのを願うばかりである。</p>
                    </div>
                </section>
                
                <div class="content-subhead">2020-07-23 00:54:06</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/07/23/call-go-from-ruby/">fiddle を使って Ruby から Go を呼ぶ</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-Go" href="https://pankona.github.io/categories/go">Go</a><a class="post-category post-category-Ruby" href="https://pankona.github.io/categories/ruby">Ruby</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>2020-07-22 に行われた「社内ゆるい Ruby LT 会」にて、「Ruby から Go を呼ぶ」というネタで話をした。</p>
<p>資料を用意しないで、実際にコードを書いて実行する様を見てもらうという感じの発表形式をとったもので「残るもの」がない。だので、資料の代わりと言ってはあれだが何をどう話したかというのを記念に本記事に記しておく。</p>
<h2 id="fiddle">fiddle</h2>
<p>Ruby から Go を呼ぶと言っても色々やり方があり、たとえば、</p>
<ul>
<li>Go で作った実行バイナリを Ruby から <code>system</code> 的なもので呼び出す</li>
<li>Go で作った HTTP Server を Ruby の HTTP Client を用いて呼び出す</li>
</ul>
<p>みたいなのも広い意味では Ruby から Go を呼ぶのに該当しそうな気がする。<br>
が、今回はもうちょっと泥っぽく、「Go で書いたソースコードを共有ライブラリ化したものを用いて、Ruby からそのライブラリに含まれている関数を呼び出す」という形式を披露した。役に立つかはさておき、一番映えそうだったからである。うふふ。</p>
<p>Ruby にはこういう「共有ライブラリを読み込むための機能」が標準で用意されていて、それが <code>fiddle</code> と呼ばれているやつである。<br>
同じような機能を提供するライブラリとして <code>ffi</code> とかそういうのもあるけど、まあ「標準」という言葉に弱い僕であるので、とりあえず <code>fiddle</code> を試していくことにした。</p>
<h2 id="何はともあれ-go-で共有ライブラリを作る">何はともあれ Go で共有ライブラリを作る</h2>
<p>まずは呼び出される側の共有ライブラリを作る作業を行った。<br>
ソースコードは以下。<code>lib.go</code> というファイル名で保存した。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="c1">//export Add
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{}</span>
</code></pre></div><p>何かのチュートリアルに出てきそうな至極シンプルな足し算をする関数。<br>
一応、普通の Go と違う点としては cgo のための諸々 (<code>import &quot;C&quot;</code> しているところと <code>export Add</code> というコメントを付与しているところ) が追記されていることかしら。</p>
<p>これを以下のコマンドでビルドする。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ go build -buildmode<span class="o">=</span>c-shared -o lib.so lib.go
</code></pre></div><p>すると、<code>lib.h</code> と <code>lib.so</code> が出力される (今回、ヘッダーは使わない)。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ ls
go.mod  lib.go  lib.h  lib.so
</code></pre></div><h2 id="ruby-から読み込む">Ruby から読み込む</h2>
<p>出力された <code>lib.so</code> を、Ruby のコード内から読み込む。<br>
このような感じで <code>lib.so</code> をロードし、その中の <code>Add</code> 関数を <code>extern</code> を使って呼び出せる状態にしている。</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;fiddle/import&#39;</span>

<span class="k">module</span> <span class="nn">M</span>
  <span class="kp">extend</span> <span class="no">Fiddle</span><span class="o">::</span><span class="no">Importer</span>
  <span class="n">dlload</span> <span class="s1">&#39;lib.so&#39;</span>
  <span class="n">extern</span> <span class="s1">&#39;int Add(int, int)&#39;</span>
<span class="k">end</span>

<span class="nb">p</span> <span class="n">M</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># 実際に呼び出しているのはココ</span>
</code></pre></div><p>実行結果は以下のようになる。期待通り。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ ruby ./main.rb
<span class="m">4</span>
</code></pre></div><p>晴れて Ruby から Go を呼び出すことができた。便利！</p>
<h2 id="ライトニングトークで触れなかった補足など">ライトニングトークで触れなかった補足など</h2>
<p>ライトニングトークでは、時間の都合上、上記の部分までの話しかしなかった (5 分という縛りだった) のだが、本手法は便利な話ばかりでもなくて不都合だとかやりにくいところだとかが色々ある。そもそも Ruby と Go に限らず、言語間バインディングなんて問題の巣窟になること請け合いであるというのが僕の印象であってだな。</p>
<p>上記のように <code>int</code> を使っている間は特に問題がないのだけれども、もう少し便利に使おうと思ったら他の型 (特に byte array みたいなものとか string) を使いたくなるのが人情かと思う。<br>
実はこのへんを扱うのは割と面倒で、何が面倒って「メモリの確保と解放」をそれなりに意識してやる必要が出てくる。</p>
<p>例えば、Go から文字列を返してやろうと思ったら以下のようなコードになる。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="c1">//export Fullname
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Fullname</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span> <span class="p">{</span>
    <span class="nx">fullname</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">firstname</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">lastname</span><span class="p">)</span>
    <span class="nx">p</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">CString</span><span class="p">(</span><span class="nx">fullname</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">C</span><span class="p">.</span><span class="nf">CString</span><span class="p">(</span><span class="nx">firstname</span> <span class="o">+</span> <span class="nx">lastname</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{}</span>
</code></pre></div><p>このコードをざっくり解説すると、</p>
<ul>
<li><code>Fullname</code> 関数は、<code>lastname</code> と <code>firstname</code> を受け取って、連結したもの (つまり <code>fullname</code>) を返す関数。</li>
<li>引数、および戻り値の型で <code>string</code> を使うようなところでは、代わりに <code>*C.char</code> を使うようにしている。<code>string</code> を扱おうと思うと Ruby 側では構造体を扱う必要が出てきて少し面倒になってしまうので、生々しいが単なる <code>*char</code> を扱うほうが簡単になる (と思う)。</li>
<li><code>*C.char</code> はそのままでは Go の <code>string</code> として扱えないので、いったん <code>C.GoString</code> に食わせて <code>string</code> に変換している。</li>
<li><code>string</code> に対して一通りやりたい処理をやったあとに、<code>string</code> を戻り値の型である <code>*C.char</code> に変換する必要がある。</li>
<li><code>C.CString</code> に <code>string</code> を食わせると <code>*C.char</code> 型になって出てきてくれるのだが、<code>C.CString</code> を使って生成した文字列は「メモリ解放」をしなければならない。しないとメモリリークになってしまう。</li>
<li>メモリ解放をして良いタイミングは Go 側からはわからないので、Ruby の側からメモリ解放のための関数を呼んであげる必要がある。</li>
</ul>
<p>そこまでケアすると以下のような感じになる。</p>
<p>Go の側。メモリ解放のための関数を追加した。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="c1">//export Fullname
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Fullname</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span> <span class="p">{</span>
    <span class="nx">fullname</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">firstname</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">lastname</span><span class="p">)</span>
    <span class="nx">p</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">CString</span><span class="p">(</span><span class="nx">fullname</span><span class="p">)</span>

    <span class="k">return</span> <span class="nx">p</span>
<span class="p">}</span>

<span class="c1">//export Free
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Free</span><span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="nx">C</span><span class="p">.</span><span class="nx">char</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">C</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{}</span>
</code></pre></div><p>Ruby の側。メモリ解放のための関数を呼び出すように変更。</p>
<div class="highlight"><pre class="chroma"><code class="language-rb" data-lang="rb"><span class="nb">require</span> <span class="s1">&#39;fiddle/import&#39;</span>

<span class="k">module</span> <span class="nn">M</span>
  <span class="kp">extend</span> <span class="no">Fiddle</span><span class="o">::</span><span class="no">Importer</span>
  <span class="n">dlload</span> <span class="s1">&#39;lib.so&#39;</span>
  <span class="n">extern</span> <span class="s1">&#39;char* Fullname(char* p0, char* p1)&#39;</span>
  <span class="n">extern</span> <span class="s1">&#39;void Free(char* p0)&#39;</span>
<span class="k">end</span>

<span class="n">ptr</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">Fullname</span><span class="p">(</span><span class="s1">&#39;pan&#39;</span><span class="p">,</span> <span class="s1">&#39;kona&#39;</span><span class="p">)</span>

<span class="nb">p</span> <span class="n">ptr</span><span class="o">.</span><span class="n">to_s</span>

<span class="n">M</span><span class="o">.</span><span class="n">Free</span><span class="p">(</span><span class="nb">p</span><span class="p">)</span>
</code></pre></div><p>実行結果は以下。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ ruby ./main.rb
<span class="s2">&#34;pan kona&#34;</span>
</code></pre></div><p>おそらくこれでメモリリークはしない状態になっている、はず。</p>
<h2 id="つまり">つまり</h2>
<p>言語間バインディングは用法と用量を守って使うのだ。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://golang.org/cmd/cgo/">cgo - The Go Programming Language</a></li>
<li><a href="https://docs.ruby-lang.org/ja/latest/library/fiddle.html">library fiddle - Ruby 2.7.0 リファレンスマニュアル</a></li>
</ul>
                    </div>
                </section>
                
                <div class="content-subhead">2020-06-30 20:44:40</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/06/30/gaming-pc-on-gcp/">GCP 上にゲーミング PC をこさえてみたが 2 日で 800 円だよ</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-GCP" href="https://pankona.github.io/categories/gcp">GCP</a><a class="post-category post-category-ゲーム" href="https://pankona.github.io/categories/%E3%82%B2%E3%83%BC%E3%83%A0">ゲーム</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>GCP 上にゲーム目的で Windows server を立ててみた話。</p>
<p>ゲームをやるための PC がほしい！と兼ねてより思っていてちょいちょい自作 PC パーツの値段をウォッチしたりしていた。<br>
あれらっていうのはやっぱりそこそこ高くて、ストレスなく遊べるようなスペックを求めると 10 万円くらいは見といたほうが良いということがわかってきた。</p>
<p>10 万円かけて買うことは不可能ではないのだけれど、それの耐用年数がどれくらいかって言われたら長くて 5 年くらいなのかねぇ？<br>
いくらパーツだけ取り替えて延命できてコスパがいいんだって言っても、どうせいずれマザーボードから取り替えないといけなくなって総取っ替えしたくなっちゃうんでしょ、というような気もしている。</p>
<h2 id="クラウドゲーミングの時代">クラウドゲーミングの時代</h2>
<p>それで、最近は <a href="https://cloudgaming.mb.softbank.jp">GeForce NOW</a> というのも出てきて、平たくいえば「マシンはクラウド上にあって、手元の (ヘボい) PC に画面をストリーミングしてプレイできるよ、グラボいらないよ」というようなことができるようになってきている。GeForce NOW のお値段は毎月 1,800 円 (本記事執筆時点ではまだ正式サービス前であるが)。たとえば Steam が対応しているけど全部のゲームができるわけじゃなくて、一部のゲームが対応しているというような感じ。<br>
実際に試してみたけれど遅延はまあまあ。快適かと言われるとちょっと微妙、くらいの雰囲気。</p>
<h2 id="geforce-now-は自作-pc-より安いのか">GeForce NOW は自作 PC より安いのか</h2>
<p>さて、前段で「ゲーミング PC こさえるなら 10 万円くらい」と書いたけれど、GeForce NOW するのとコスパを比べるとどうか、ということを考えた。</p>
<p>10 万円かけて耐用年数 5 年 (つまり 5 年後に買い換える想定) だとすると、年に換算すると 2 万円/年。月に換算すると 1,666 円/月。GeForce NOW が 1,800 円であることを思うと、この前提だとちょっとだけ自作したほうが安い。<br>
けど、GeForce NOW のようなものは「マシンが壊れない」、「デスクトップ PC をあらたにこさえる必要がない (場所をとらない)」、あとは「自分の PC は省電力で済む」等のメリットがあるっちゃあるので、必ずしも自作したほうがお得かっていうとそうでもないような気もする。トントンくらいか、故障したときの話とかあるいはマシン廃棄のコストを考えたら実は GeForce NOW のほうが安いだろうみたいな考えもできる気がする。</p>
<h2 id="windows-server-を-gcp-上に立てる試み">Windows server を GCP 上に立てる試み</h2>
<p>GeForce NOW の欠点は対応ゲームが少ないということ。<br>
現在 (2020-06-30) はまだ正式サービス前なのでこれからいっぱい増えていく可能性は大いに期待しつつ、とはいえ今はまだ対応ゲームが少ない。</p>
<p>ということで、であれば自分で GCP 上に Windows ゲーミングマシンを立ててみたらどうかと思い、とりあえずちょっと試してみた。自分で生 Windows を立てるのであるから、原理上は Windows 対応のゲームであればなんでも動かせるはずである。GCP ならマシンスペックもまあまあ選びたい放題になるはずである。</p>
<h2 id="参考にさせていただいたサイト">参考にさせていただいたサイト</h2>
<p>以下のウェブサイトを参考にさせていただいて作業を行ったところ、実際にゲームを動かすところまでこぎつけることができた。</p>
<ul>
<li><a href="https://troches.jp/contents/tech/781">GCP にゲーミング PC を作成する方法 - icecream</a>
<ul>
<li>主な作業内容はこちらを参考にさせていただいた。感謝。</li>
</ul>
</li>
<li><a href="https://qiita.com/y_kani/items/ddb7c4a5ca6fdf36cac4">GCP の Deep Learning VM インスタンスを立ち上げる - Qiita</a>
<ul>
<li>先述のサイトの解説では GPU の割当がうまくいかないところがあったのだけど、本記事を参考にしたところ解決できた。</li>
</ul>
</li>
<li><a href="https://www.ryadel.com/en/install-google-chrome-with-powershell-script/">Install Google Chrome on Windows Server with a Powershell Script</a>
<ul>
<li>Windows server に Chrome をインストールするワンライナー。やるときは PowerShell を管理者権限で立ち上げる必要がある。</li>
</ul>
</li>
<li><a href="https://www.vb-audio.com/Cable/">VB-Audio Virtual Cable</a>
<ul>
<li>選んだ OS は Windows server 2019 datacentor だったのだけど、サウンドカードがなくて音が出ないという憂き目にあった。</li>
<li>仮想サウンドカードとして機能する VB-Audio Virtual Cable をインストールしたところ、音を出すことができた。便利。</li>
</ul>
</li>
</ul>
<h2 id="体験としてどうか">体験としてどうか</h2>
<p><a href="https://parsecgaming.com">Parsec</a> というツールを使って GCP 上の Windows の画面を手元の PC (Mac) にストリーミングしているのだが、驚くべき低遅延。<br>
ほとんど手元で実機を動かしている感覚と変わらないと言っていいかもしれない。何なら GeForce NOW より低遅延まであるかもしれない。これは凄い…。</p>
<p>動かすマシンがなかったという理由で積むだけ積んどいたスチームゲーのうち、<a href="https://store.steampowered.com/app/287700/METAL_GEAR_SOLID_V_THE_PHANTOM_PAIN/?l=japanese">メタルギアソリッド TPP</a> を試しに動かしてみたけどもうヌルッヌル動く。ヌルヌルである。たぶんちゃんと 60 FPS でている。手元のマシンのファンがうねりを上げることもない。これは革命では…！</p>
<p>ここんところあんまりゲームをやっていなかったのだけど、ちょいちょいゲームやりたい気持ちになる程度にはヌルヌルであった。コントローラー買ってこなきゃ…！ (キーボードとトラックボールでは操作が厳しいことがあるので)</p>
<p>ヌルヌルなんだけども、なぜか不定期にカクカクしちゃうことがある。何事かと思って調べてみると、どうもネットワークの遅延が原因である模様 (Parsec はネットワークのレイテンシを常時表示してくれる。便利)。<br>
これは無線 LAN を使っていることが原因であるかもしれない。やむなし。有線 LAN にしたら解決するのかもしれないけど家の構造上きびしい。</p>
<h2 id="なおコスパ">なおコスパ</h2>
<p>2〜3 時間ほど設定に費やし、その後もろもろテストプレイに 2〜3 時間費やしたところ、現在の請求はおよそ 800 円であった。Oh、800 円か&hellip;！<br>
概ね 5 時間くらい VM を起動したことになろうか。5 時間で 800 円。何もしなくても消費される課金もあるのでそこまで単純ではないものの。1 時間あたり 160 円？<br>
preemptive (意図せず VM が落ちることがあるが、お値段がとても安い) を選んでいてもこれである。</p>
<p>ゲーセンに行くと思えばコスパは断然良いのだが…。どんだけプレイするかにも依るけれど、この分だと月に 5,000 円くらい掛かったりするような気がしないでもない。<br>
えっ、高くないですか？そんなに？これなら 10 万円 PC 買ったほうが全然安い気がしてくるんだけどどうなのか&hellip;？</p>
<p>とはいえ便利なことに違いはないので、ひとまず一ヶ月間様子を見てみて、お値段がおいくらになるのか検証してみたいと思う…！</p>
                    </div>
                </section>
                
                <div class="content-subhead">2020-06-22 14:56:41</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/06/22/oyashirazu_is_dead/">親不知を抜いたけど超痛かったよ？</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-歯" href="https://pankona.github.io/categories/%E6%AD%AF">歯</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>本ブログには技術的なことを載せていこうと思っているんだけども、どうしても書いておきたいことができてしまったので書いておく。<br>
親不知を抜いた話。</p>
<p>歯医者に歯のクリーニングをお願いしたときに、「あー親不知が生えているから若いうちに抜いたほうがいいよーなぜならうんぬんかんぬん…」と言われて、<br>
まあ確かにそうだねぇ、コロナでリモート生活している今のうちにいっちょ抜いてしまいますかーと心を決めたわけである。</p>
<p>とはいえ親不知を抜くと決めてからはもうビビりまくってしまって、親不知を抜いた先輩方に「痛いの？その後腫れるの？」等と自分から自分の恐怖を煽りにいくようなことを質問しまくって過ごしていたわけである。怖い。<br>
でもね、諸先輩方が言うには「抜いている間は痛くないですよ」だったり、「麻酔が切れてきたらちょっと痛むから早めに痛み止めを飲むのがいいよ」とか、そういう感じの「術中は痛くない」という評判だったわけ。<br>
だからね、まあ大丈夫かなーその後ちょっと不自由するかもだけど痛み止めあるしなーでもまあ大丈夫でしょー、なんて思っていたのでありました。</p>
<p>そんでいざ親不知を抜く段になったんだけども、処置が始まった当初は「ふむふむ、大方の予想通りあんまり痛くないね。ふむふむ。さすが日本の麻酔技術…」なんて思っていたんだけども、中盤に差し掛かると様相が変わってきて。<br>
痛い。なんか普通に痛いぞ？いや、我慢できんってほどでもないんだけど、「痛くないって言ったら嘘だよね」みたいな気持ちになってきた。痛い。</p>
<p>一応先生は「痛かったら言ってくださいねー」と言ってくれていたし、時折「大丈夫ですかー？」って聞いてくれる。ありがたい。さすが日本の歯科技術。ホスピタリティ。</p>
<p>施術中はしゃべりにくい (口に器具やら何やらを突っ込まれているから) ということもあり、大丈夫ですかー？に対しては鎌倉の大仏のような OK サインで応えていた。<br>
何かを焼き切るタンパク質が焼けるような匂いをかぎつつ、何かを砕くような音を感じつつ、あ、なんかこれはいよいよ痛いなーって思ったんで、大の大人だけどまあやむなし、満を持して、恥を忍んで言ってみたんですわ。</p>
<p>わい「ｲﾀｲ…ﾃﾞｽ…」(OK サインを崩して両手を広げるようなジェスチャーをしつつ)<br>
先生「あー痛みますか―。」<br>
先生「神経が露出してるから痛むんだな…(独り言みたいなボリューム)」</p>
<p>えっ、終わりかい？日本の麻酔技術どうした？ホスピタリティ？<br>
痛むんだな…じゃーないんだよ。何を冷静に分析しているんだね？はい、痛みますけども？</p>
<p>このへんで僕は、あっ、痛いことを表明してもどうにもならないんだね、ってことを悟ったので、あとの時間は力強く、そりゃーもう力強く OK サインを握りしめて、あぶら汗をひたいに浮かべながら施術終了を待つことになったわけである。南無…。</p>
<p>程なくして (永遠に感じられた) 施術は終わったものの。<br>
おかしい。こんなはずでは…。<br>
少なくとも術中は痛くないはずではなかったか。医師の技量の問題なのか、あるいは僕の歯の生え方とかそういうのがもたらした必然であるのか…。</p>
<p>幸い、術後の経過順調でそれほど腫れ上がったりだとか夜も眠れないみたいなことはなかった。</p>
<p>でもね、とにかく術中は痛かった。それだけは覚えておきたいと思った。<br>
後世 (これから先に親不知を抜く人) に伝えたいと思った。痛くないなんてことはないんだよ、と…。</p>
                    </div>
                </section>
                
                <div class="content-subhead">2020-06-12 10:39:35</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/06/12/the_team/">「THE TEAM 5つの法則」を読んだのでちょろっと感想</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-EM" href="https://pankona.github.io/categories/em">EM</a><a class="post-category post-category-本" href="https://pankona.github.io/categories/%E6%9C%AC">本</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>他の EM (Engineering Manager) から「THE TEAM 5 つの法則」という本をオススメされたので読んでみた。<br>
読書感想文を書いておく。</p>
<p><a target="_blank"  href="https://www.amazon.co.jp/gp/product/B07PZB9DTK/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B07PZB9DTK&linkCode=as2&tag=pankona-22&linkId=dcf00a7b626c287bbadac7a02c82a6d2"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=B07PZB9DTK&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=pankona-22" ></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=pankona-22&l=am2&o=9&a=B07PZB9DTK" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>
<h2 id="とても読みやすい">とても読みやすい</h2>
<p>内容とあんまり関係ない話ではあるが、スラスラ入ってくる感じの文体で非常に読みやすいと感じた。<br>
理解が難しい箇所がほとんどなくて、読んでいてストレスがなかったのが印象的。本ってしばしば「途中まで読んだはいいもののまた再開するのが億劫で積まれていく」みたいになりがちかと思うが、そういう気持ちにはあんまりならなくて、サクッと再開する気持ちになれたというか、気楽に読めるというのはとても良いと思った。まあ内容に興味があったから早く先を読みたいっていう気持ちだっただけかもしれないが。<br>
およそ 300 ページくらいでそんなに多くないのもあるけれど、サクッと読める感じでオススメ。</p>
<h2 id="モチベーションの話">モチベーションの話</h2>
<p>「モチベーションを出せ！」「気合だ！」等と言われてもモチベーションがあがらない (何なら下がるまである) というのは体感、あるいは体験として感じていたところではあるが、じゃあどのようにすればモチベーションが上がるんですかね、っていうようなことが書かれていてこのへんはとても興味深かった。<br>
書かれていたのは結局のところ、「何にモチベーションを見出すのかは人それぞれだから、モチベーションを高める &ldquo;それ&rdquo; をお互いに提供できるように努めような」というような話なのかと理解していて (雑理解かもしれない)、まあそれはそうですよね、って思うところ。</p>
<p>なんだけども、そもそも「各々が何にモチベーションを見出すのか、あるいは何にモチベーションが下がるのか」っていうのをちゃんとチームの人々がお互いに知っているんだっけ？言語化できてるんだっけ？というとあんまりそんな気はしなくて、なのでそのへんの認識を合わせる何らかの催しみたいのはやってみたら面白いかもねぇ、等と思いながら読んでおったわけである。</p>
<p>だいたい「何がモチベーションになるか」なんて自分のことですら良く分かんない事柄ではありそう。</p>
<h2 id="もう少し細かいモチベーションの話">もう少し細かいモチベーションの話</h2>
<p>本書には「4 種類のモチベーション」というのが紹介されていて、それは以下の 4 つであると。</p>
<ul>
<li>Philosophy (理念・方針)</li>
<li>Profession (活動・成長)</li>
<li>People (人材・風土)</li>
<li>Privilege (待遇・特権)</li>
</ul>
<p>これのうちのどれか 1 個にモチベーションを感じるというよりは、4 つそれぞれにどんだけモチベーション感じるかっていう感じで、ダイヤモンド的なグラフにできるようなものなんだろうと思う。<br>
これらの分類分けっていうのはなんとなく&quot;分かる&quot;というか、これを念頭にメンバーの顔を思い浮かべると「あーあの人はこれにモチベーション感じてそうだなー」等と思い当たったりするような気もしてくる。<br>
これを意識しながら 1on1 に望んだりすると、ちょっと相手への理解の解像度が増したりするのかもしれない。現在担当しているロール (マネージャなのか、そうでないのか、とか) によってどの類のモチベーションを感じやすい、みたいなのもありそう。</p>
<p>あとこれは他ならぬ自分自身がどれにモチベーションを感じているか、ってのを考えるのにも役立ちそう。セルフモチベートに用いるというかね。そういうの考えて整理しとくのも大事かと思われる。自分のような「最低賃金がまあまあであれば、あとは Go 書ければだいたい凄く満足するんだけどなー」みたいのは、「待遇そこそこ、活動強め」くらいな感じでモチベーション感じているのかなー、のように分類されるんだろうか。</p>
                    </div>
                </section>
                
                <div class="content-subhead">2020-06-06 12:09:43</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/06/06/em-dialy-2020-06-06/">EM としてメンバーを成長させるなんておこがましいと思っていたのだが</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-EM" href="https://pankona.github.io/categories/em">EM</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Engineering Manager (以下 EM) の仕事のひとつとして、しばしば「メンバーの成長を促す」みたいなことが書かれているのを目にする。</p>
<h2 id="開幕からもう何も教えることはないのだが">開幕から「もう何も教えることはない」のだが</h2>
<p>いまの自分の状況に照らすと、<br>
「メンバーの成長って言うけどメンバーのほうが強いんですけど？何も教えられることなんてないんですけど？何も言わないでも爆速でみんな成長しているように見えるし、何ならむしろ僕は教わる側なんですけど？」<br>
みたいなことを思いがちな現状であって、つまり「EM がメンバーの成長を促す」というのは、</p>
<ul>
<li>メンバーにジュニアレベルな人がいるとか</li>
<li>あるいは EM がすごく経験豊富で教えることがたくさんある</li>
</ul>
<p>みたいな状況における仕事なんじゃないかな、という理解をしていて、なんなら今の自分にはあんまり関係かな、と思っていた。</p>
<p>なんだけど、2 ヶ月 EM 生活をしてきて少しだけ考えが変わってきた。</p>
<h2 id="誰も-em-が自ら教えろなんて言ってないことに気づく">誰も EM が自ら教えろなんて言ってないことに気づく</h2>
<p>強いメンバーがいて、強いもの同士でペア作業であるとかモブ作業であるとか、その他なんでもいいんだけど「複数人での共同作業」をやっていると、ちょっとしたことでも色々知見だとか知識の共有が行われているってことに気づいた。<br>
この様子を見て、「成長の援助する」っていうのの形は、なにも EM 手ずから何かを教えるとか導くとか、そういうのに限らないんじゃないか、ってことに気づいてきたわけ。</p>
<p>弊チームでは色々の事情を勘案して、いまは「いっぱい協業しようね」というのをテーマにして作業を行っている。<br>
つまりこれも一種の「成長を促す環境作り」みたいなもんなんじゃないかな、と思い、言い換えればこういう状況を作っていくことがすなわち「成長を促す」と言ってもいいんじゃないかと思った。<br>
こじつけっぽいが、そう考えるとちゃんとメンバーの成長を促す仕事をしているような気がしてきた。審議？</p>
<h2 id="成長を促すやり方は他に何があるか">成長を促すやり方は他に何があるか</h2>
<p>で、共同作業だけが成長を促すやり方ではないはずで、いろんな成長を促す手法を知っておく必要があるなーと思った。協業みたいの嫌いでもくもくやりたがる人もいるしね。</p>
<p>たとえば、案として、</p>
<ul>
<li>任意の何かを勉強する時間を業務時間中に設けてカジュアルに発表し合う場を作る</li>
<li>任意の事柄についてライトニングトークできる場を作る</li>
</ul>
<p>みたいな、これはどちらかと言うとアウトプットのほうにフォーカスしている案かもしれないが、こういった催しを継続的に行う立て付けを作る、っていうのもナレッジを高める手段であろうと思う。まあしかし、この手のものは言われてやるって言うと急にやる気なくなったりする一面もありそうで、やるにしても導入の仕方が難しいような気がしないでもない。まずは小さく、気軽に、そして何より隗より始めるのが良いのかな―等と思ってみたり。</p>
<p>「毎週この時間は Go の勉強会」みたいのだったら自分でもちょいとはできそうかもしれない&hellip;。いいじゃん&hellip;。みんなでおっちゃんと一緒に標準ライブラリ読もうや&hellip;。</p>
<h2 id="やはり-em-は地相を変える仕事であったのか">やはり EM は「地相を変える仕事」であったのか</h2>
<p><a href="/blog/2020/05/30/em-dialy-2020-05-29/">先日のポスト</a>で、「EM の仕事はロマサガ 3 で言うところのコマンダーバトルであり、地相を変えるのが EM の役目なのでは」等と雰囲気で書いていったわけであるが、 本稿の「成長を促す環境作り」みたいのはまさに「地相を自分らに有利なように変えていく」みたいに見えはしまいか。見えんかね。どうかね。</p>
<p>現在の地相が自分らに有利なのか不利なのか、地相を変えるとしてどの地相に変えると有利なのか。現実はもっと変数が多くて複雑であるのでゲームのように火星の砂を放っておけばいいという話にはならないわけだが。なんとなく共通点があるような気がしないでもない。まあちょっとこじつけではある。うむ。</p>
<h2 id="em-も悪くないとだんだん思えてきた気がしないでもない雰囲気を感じつつある">EM も悪くないとだんだん思えてきた気がしないでもない雰囲気を感じつつある</h2>
<p>先日までエンジニアだった自分は、しばしば「マネージャの仕事はコード書く量が減ってしまってつまらん」等と思いがちであるのだけれど、ただこうして「どういう課題に脳みその大半を割くのが EM の仕事なのか」ってのに整理がついてくると (ここで言うところの、どうやったらメンバーが成長するのか、という課題) 、それなりに重要で、それなりにやりがいのある、それなりに面白みのある、もののように思えてきている気がする。</p>
<p>これは自分にとっては大きな心境の変化で、日常のストレスの感じ方に直結しているのを強く感じる。当初よりはストレスフルでなくなってきたというかね。もしかしたら単なる慣れかもしれないが。課題が見えてきて、あるいは言語化されてきて、「納得感」が醸成されてきたってことかもしれない。納得は全てに優先するじゃん？</p>
<p>というような感じで 2020 年 6 月もやっていく。おかげさまでリモートを続けられる環境で嬉しい。</p>
                    </div>
                </section>
                
                <div class="content-subhead">2020-06-03 10:47:03</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/06/03/kichijojipm-22/">吉祥寺.pm 22 に参加</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-イベント" href="https://pankona.github.io/categories/%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88">イベント</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>2020-06-02、吉祥寺.pm 22 (今回はオンラインでの開催) に参加した。<br>
今回のテーマは 「変わったこと、変わらなかったこと」</p>
<p><a href="https://twitter.com/search?q=(%23kichijojipm)%20until%3A2020-06-03%20since%3A2020-06-02&amp;src=typed_query">当日のツイッターの様子 (#kichijojipm since:2020-06-02 until:2020-06-03)</a></p>
<div style="max-width: 800px">
  <a href="https://kichijojipm.connpass.com/event/177459/"><img src=/images/kichijojipm-22/kichip22-01.jpg></a>
</div>
<p>以下、登壇に使われた資料の一覧。<br>
※ 一部の資料が発見できなかった&hellip;。アップされていないかもしれない。</p>
<h2 id="トークセッションの発表資料">トークセッションの発表資料</h2>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="fea16359855c43af823d96a8ca18965b" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="8a400f0424104ac8a011a5fb74957b58" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="d2cf7e0b49d443acbf017db851ebab8c" data-ratio="1.77725118483412" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<h2 id="lt-の発表資料">LT の発表資料</h2>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="0fe2f9903d4740b6961bcbbe0b5fc577" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="2082b04cdee1409f9afed70e5f266f62" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="max-width: 800px">
  <iframe width="100%" height="315px" src="https://www.youtube.com/embed/6F-q8stbwrg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="91db1b1293b943568a3f8a8a4c38ab9e" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="max-width: 800px">
  <script async class="speakerdeck-embed" data-id="966b216d5b3845d0adb3bd3d29e9ad55" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<h2 id="参加した所感など">参加した所感など</h2>
<p>今回の吉祥寺.pm は初のオンライン開催だった様子。Zoom に 90 人くらいかな？が接続しているような状況での視聴だったけれども、概ね問題なく (むしろ快適に) 視聴できたと感じた。</p>
<p>しかしオンライン勉強会の弱点というか、視聴者の反応を発表者に伝えにくいという点があるというのも感じた。視聴者側ができるリアルタイムなフィードバックとしては、Zoom のチャットで色々反応してみるだとかツイッターで呟いてみるだとかあると思うのだけど、とはいえリアル登壇であったような「発表中にリアルタイムに反応を見る」のとはちょっと違うやね。それは発表者からしたら逆に視聴者が目の前にいないということで「緊張しにくい」とかはあるのかもしれない。でもやっぱ反応が感じられないのが不安だったりするんかな。発表中に、ニコニコ動画のあれとまでは言わないけど、画面の端っこにガヤが入れられるくらいのシステムがあったら良いのかもしれないねー、等と思ったり。</p>
<p>普段の吉祥寺.pm は、吉祥寺の公民館みたいなところ (黒板とか黒板消しクリーナーが完備されていて「いかにも」な部屋) で実施されていて、聞いた話によると「句会」扱いでイベント予約しているらしい。句会扱いになってしまうのは公民館側の仕様らしいが…。<br>
なので、普段の吉祥寺.pm では発表資料のどこかで「一句詠む」のが通例になっているらしい。ほんまか？ほんまだったらすごいオモシロイじゃん…。<br>
その流れもあってか、オンラインに場所を移した本勉強会においても各々思い思いの一句を詠んでいて、なんというかそれもまたひとつの見所だったんじゃないかと思う。<br>
今回のお気に入りの一句は <a href="https://twitter.com/qsona">@qsona</a> さんの**「怖くない GraphQL is Better REST」**でした。若干字余り。逆に渋い。</p>
<p>あと興味深いことに、今回は「日常の料理の献立を考えるのが大変」みたいな文脈の発表があった。このような一見すると IT に関係ないような (って言ったら失礼かもしれないが) 発表がしばしばあるのも吉祥寺.pm の良いところではないかと思う。<br>
どうしてもね、興味のある勉強会ばっかり言っていると知識の傾向が偏ってしまうというかね。ある気がするけれど、吉祥寺.pm なら色々雑多に聞けて自分の見識が広がって便利。とてもオモシロイ発表でした。絵がとてもとても上手で憧れる。</p>
<p>オンライン吉祥寺.pm は今後も月に一回くらいずつやろうか、等ともささやかれていたので、次回の開催も大いに楽しみにしておくぞ。</p>
                    </div>
                </section>
                
                <div class="content-subhead">2020-05-30 12:30:16</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/05/30/em-dialy-2020-05-29/">Engineering Manager とはやっぱりコマンダーバトルなのではないか</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-EM" href="https://pankona.github.io/categories/em">EM</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Engineering Manager (以下 EM) を始めて二ヶ月くらい経った。依然として EM というものはいったい何なのかを考え続けている。</p>
<h2 id="引き続きもやもやしている">引き続きもやもやしている</h2>
<p>弊社 (Quipper) において EM が最低限こなさなければならない「義務」のようなものは概ね把握してきた。<br>
それは第一には「メンバーの評価」であり、第二には「採用活動」である。これらは将来変わるかもしれないが、いま時点においてはこれらが EM の仕事といって差し支えないように見えている。実際、業務時間のだいたいはこれらに関する何かで時間を使っている。</p>
<p>さて、4 月に EM になってから 5 月末に至るまでずっと「もやもやした不安」を感じていた。<br>
それは「EM になったはいいけど、EM ってどういう仕事する人なんだっけ」っていうのをよく分かっていなかったからだと思っていたのだけど、先述のようにそのへんが概ね明らかになってきたにも関わらず、やはりもやついた気持ちが晴れてこなかった。いったい僕は何を不安に思っているのか。天が落ちてくることでも心配しているんだろうか。</p>
<p>そんな悩みとも何とも言えない晴れない気持ちを、たまたま目の前 (※ やりとりは Slack なので目の前というのは少し語弊がある) にいた <a href="https://github.com/ujihisa">@ujihisa</a> さんに相談してみた。<br>
僕が思うに、ujihisa さんはもやもやした形の曖昧な気持ちや事象に「名前をつける」であるとか「モデル化して可視化してくれる」であるとかのチカラが凄いんである。けれどそれは本稿では割愛して、また別の機会に分析してみたいと思う。ほんと凄いんですよ、ええ。</p>
<p>そんで、もやもやを五月雨式に ujihisa さんに向かってダンプしていくうちに、だんだんその不安の正体がつかめてきた気がしてきた。<br>
端的に言うと、「プロダクトに対する貢献感が少ないことに対して焦っている」んじゃないか、ということであり、つまりもうちょっと砕いて言えば「あんまりコード書いてないから&quot;やってる感&quot;を感じない」ということでありそうな気がする。<br>
確かに、僕が近頃こなしている数々のミーティングや採用活動は、直接プロダクトを良くしているわけではないと感じている節がある。EM になる以前はもっとプロダクトへの直接的な寄与をできていたと思うし、それといまとのギャップも相まって「こんな仕事してて良いんだろうか」って考えてしまうってことなんじゃなかろうか。</p>
<p>しかし実際のところ、チームメンバーが鬼強い人たちばかりであるので、僕があんまりコードを書かなかったところで特に何も問題は起きないという一面がある。何もしなくて良いのである。<br>
このシチュエーションはマネージャから見たらイージーモードと言えるのかもしれないが、ただ、そういう意味では「やっぱ自分はあんまりチームの役に立っていないなぁ」みたいなことも考えてしまうやつなのである。</p>
<p>うだうだ書いたが、つまり一言で言って「プロダクトを作っている感がなくて虚無を感じている」ということかと思われる。うむ。</p>
<h2 id="その虚無は本当に虚無か">その虚無は本当に虚無か</h2>
<p>評価にせよ採用活動にせよ、はたまたコードを書くにせよ、それらは誰かがやらねばならないし、大きな価値のある尊い仕事であると思う。どっちの仕事が優れててどっちが劣っているという話ではない。<br>
なので、僕が最近の自分自身の仕事に「やってる感を感じてない」とはいえ、それらには一定の価値があろうとも思う。断じて虚無ではない。</p>
<p>問題は「自分が思い描く寄与の形と、現実にギャップがある」ことで、それがつまり「仕事がつまらん」みたいな感情に繋がりつつあることである。<br>
とはいえこの構図は、「やりたいことをやりたいようにやることが寄与に繋がってきた」今までの体験が、ロールが変わることによって一部崩れてしまい、その変化に対してダダを捏ねているようにも見えなくもないね…。みたいなことにも気付きつつある。</p>
<p>というわけで、目下は「どのようにやってる感を感じるか」というのがひとつ課題なのかと思う。自己効力感というか何というか。<br>
ujihisa 曰く、「プロダクトに時間が割けない中でプロダクトへの効力感を感じるには、周囲に助けてもらって自分にプロダクトの仕事をさせてもらう」のが良いのではないか、である。<br>
なるほど、何か難しそうであるが、これならメンバー評価の仕事をしつつ、自分もプロダクトに寄与していけるような気がしないでもない。助けてもらう前提 (ペアやモブ作業を行うという意味) であれば、たとえ割ける時間が少なかったとしても、多少なりとも自分が納得していけるような活動になっていく気がする。</p>
<p>一方で、言わば「プロダクトへの間接的な寄与」(直接的な寄与、と先述したのでそれに対するものの表現) に対しても同様の尊みを自分自身が感じていくのも大事かなぁと思う。<br>
コミットログや GitHub の草のように可視化されるものでもないし、どのように達成感を得たらいいんだろうか。ここはもう少し分析や考察がいるところ。</p>
<h2 id="ロマサガ-3-のコマンダーバトル">ロマサガ 3 のコマンダーバトル</h2>
<p>ところで、ロマンシングサガ 3 にはコマンダーバトルという戦闘モードがある。一言でいうと「主人公は直接戦わなくて後ろからざっくりとした指示を出す」モードである。<br>
当時としては割と斬新な戦闘システムだったかと思う。二周目のプレイとかはコマンダーバトル縛りでやったような記憶がある。サラを主人公に選ぶとラスボスで強制的にコマンダーバトルになったりするけどあれはちょっとあんまりだと思った。少年も仲間だったんですけど没収されてしまうし。いま思うとホントひどいなこのゲーム&hellip;。好きだけど。</p>
<p>ちょっと記憶が曖昧だけど、コマンダーバトルというのはたしか各位に細かい指示は出せないんだった気がする。全員戦うとか全員守るとかの方針を決定するのと、どんな陣形で戦うかっていうのと、陣形技っていう複数人が連携する技を指示するとか、あとは主人公が後ろからアイテムを使うことができる、くらいだった気がする。<br>
不自由かと思いきや、いくらかメリットもあり、コマンダーバトルではパーティメンバーは毎ターン HP 回復するし (戦闘不能だったら HP 1 で復活する) 、陣形技は超強力。軌道に乗ってくると通常の戦闘モードよりもコマンダーバトルのほうが安定するまであるような気がするし、だんだん楽しくなってくる。あと楽。</p>
<p>少々こじつけかもしれないが、EM の仕事というのはある意味コマンダーバトルみたいなところがあるのではないかと思う。 EM は直接敵と戦うわけではないが、戦況に鑑みて陣形と作戦指示だけしていく、みたいな。まさに同じ構図。そっくりじゃないか。俺はサラだったのか。まあなんというかね、コマンダーバトルはものすごい好きになることができたので、これもやはりこじつけかもしれないが EM の仕事も好きになれるんじゃないかと思っている。きっと僕の仕事は後ろから火星の砂とかを使って地相を変えることなんじゃないかな。どちらかと言うと寒い感じの地相にするほうが得意かもしれないが。</p>
<h2 id="以上をふまえた-6-月の取り組み">以上をふまえた 6 月の取り組み</h2>
<ul>
<li>ペア/モブ作業を通してプロダクトに多少は寄与していく</li>
<li>ミーティングをコンパクションしてプロダクトへ寄与する時間を増やす</li>
<li>地相を変える仕事に尊みを見出す</li>
</ul>
                    </div>
                </section>
                
                <div class="content-subhead">2020-04-23 12:21:34</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/04/23/em-dialy-2020-04-23/">Engineering Manager というものになったようだが何がなんだか分からない</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-EM" href="https://pankona.github.io/categories/em">EM</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>2020 年 4 月から所属している会社 (Quipper という) で Engineering Manager というロールをやっていくことになった。</p>
<p>これを書いているのが 2020-04-23 なのでロールを言い渡されてから概ね一ヶ月くらい経過しているのであるが、未だに Engineering Manager というものが何をすべきロールなのかちゃんと分かっていない。というのも、メンバーに「Engineering Manager って何する仕事なんですか」って聞いても (これを僕から聞くのもあれなんだけども) 、割とみんな Engineering Manager に期待する動きというのがバラバラであり、「メンバーが開発に集中できるようにする」と言う方もあれば、「開発もそれ以外もなんでもやる人でしょ」等と言う方もあったりする。なんでもってなんだ。植木に水でもやるか。</p>
<p>で、自分でも色々考えてみて、何をすべきかっていうよりは逆に「これは EM の仕事じゃなくてもいいよね」みたいのをちょいちょい集めていっている。</p>
<ul>
<li>こぼれ球拾っていくみたいな動きも別に EM じゃなくていい (権限が必要な場合は除いて気づいた人やればいい) 気がする</li>
<li>なんでもやるってのは土台無理な気がする</li>
</ul>
<p>最終的にメンバーの評価をするっていうのは EM しかやれないこと (これは弊社の立て付け上の事情だろうけども) なので、そのために 1on1 する等して色々な情報を収集する、みたいなのは自分がやらないといけないよね、というのは気づいたところ。<br>
その情報収集を通して雑多に情報が集まってくると思うので、その情報を元に自分にしか見えない (あるいは他の人に比べて自分が気づきやすい) 問題っていうのはあるのかもしれない。ので、そのへんを意識して解決するように頑張っていくっていうのが EM として価値のでる仕事なのかなー等と考えていたところである。曖昧。</p>
<p>あと比較的安価なものであれば決済する権限も与えられているようなので、精一杯濫用していきたいと思っているところ。<br>
昨今はコロナの影響もあってリモートワークが盛り上がっているので、経費使ってリモートお茶会くらい開催してもいいんじゃないかなー。どうかなー。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2020-04-09 10:50:55</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2020/04/09/misc/">Blog が書けない理由を考えていたら数ヶ月が過ぎた</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>ブログは誰に見せるでもなくても、自分の気持ちとかやってたことを記録しておけるってだけで書いておいて意義があると思っているのであるが、なかなかどうして書くことが思いついてもそれをブログにしようと思わない、筆が進まない、というか筆をとらない、という日々が続いていた。</p>
<p>これには何か理由があるんだろう、わかったぞ、さては「ブログを書く体験」が良くないんだな、仕組みを変えなきゃ、どのように変えるか、等とうだうだ考えていたら数ヶ月が経っていた。ウケる。</p>
<p>しかし結局のところ「書くならちゃんとした記事を書こう」みたいに思っちゃうのがハードルなのかもしれないね、と思ったのである。<br>
ということでいったんこのような雑な記事をポストしておいて、そういった「ちゃんと」の呪いから解き放たれていこうと思った。<br>
目指せ、一年で 30 記事くらい (毎月 2.5 記事ペースね)。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2019-08-04 16:14:51</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2019/08/04/join-in-quipper/">Quipper に転職して三ヶ月が経った</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>さて、2019 年 5 月に <a href="https://www.quipper.com/">Quipper</a> に入り、3 ヶ月が過ぎた。<br>
入ってから 3 ヶ月は試用期間という扱いであったので、このブログを書いている 8 月はちょうど試用期間が終わった段階になる。</p>
<p>試用期間が終わったからと言って何かすごい権限が付与されるとか、ただちにクビになる心配がなくなるとか (そもそも試用期間だからっていきなりクビを切るのは難しいよねきっと) っていう変化は特になく、これまで通りのルールでこれまで通り業務をしていくという感じではある。<br>
とはいえ試用期間が終わったということで、公の見方としてはようやく正式に (？) 社のメンバーになったということなのではないか。<br>
ということで転職エントリー地味たものを書き記しておこうという気になったわけである。</p>
<h2 id="現職は--いくつか">現職は ☆ いくつか？</h2>
<p>先日、「ところで Quipper どうよ？」みたいな往年の 2 ch を思わせるような質問をマネージャに投げかけられたわけである。1on1 で。☆ いくつよ？みたいな。</p>
<p>そんな「☆ いくつ」みたいなどっかの料理ショーみたいな採点はひとくちには難しかったので即答はできなかったものの、自分が何をポジティブに、もしくはネガティブにとらえているのかを改めて考えてみた。</p>
<h3 id="ポジティブポイント">ポジティブポイント</h3>
<ul>
<li>英語キーボードの PC が使えて嬉しい。設備繋がりで言えばキーボードもマウスもお気に入りのやつ買ってもらえて嬉しい (前職では毎日リアルフォースとスリムブレードを持ち運んでいたので腰が死んだ) 。</li>
<li>そういえば Go 書きたいと言って始めた転職活動だったのを思い出したが、Go をちょこちょこ書けてて嬉しい。言語繋がりで言えば、不慣れな Ruby に挑戦出来ていてこれはこれで楽しい。</li>
<li>ちゃんとしたスクラムをしている。受託ではないからスクラムやりやすいっていう一面はありそう (前職はしばしばスクラムもどきをしていた) 。</li>
<li>質問しやすい雰囲気があって仕事しやすい。Slack に雑に質問をすると (役に立つか立たないかは一旦置いといて) 何らかのリアクションがそれなりの速度で返ってくる。これは非常に良い体験。</li>
<li>同様の文脈で、Slack 上で雑談がしやすいというのもある。業務と無関係な呟きをする (関係あってもいいんだけど) 個人用のチャンネル (xxxx_times、みたいなやつ) がいくつも生えていて、連日賑わっている。</li>
<li>採用の透明さ。その気があれば採用に関わっていけるし、その気がなくても採用に関する情報はオープンになっていて「誰が応募してんのかな、どこまで行ってんのかな」とかが分かって嬉しい。</li>
<li>リモート多めの面々なので、リモートでのコミュニケーションをまあまあ前提にしてよいところは嬉しい。</li>
<li>コミュニケーションはほとんど Slack と GitHub で完結している。これはエンジニアに限らずである。人事からプルリクが飛んできてビビる日々。
<ul>
<li>ビジネス上の意思決定とか組織の検討とかも Slack や GitHub 上で行われているので、月並みな言葉で言えば「情報がオープン」であろうか。暇なときに眺めてはへぇーへぇーって言ってるだけだけど。</li>
<li>社内情報を検索するときは、まず Slack、その次 GitHub、その後誰かに聞く、みたいな順番でやればだいたいヒットする。</li>
</ul>
</li>
<li>組織がフラット。フラットというか、仕事をする上で組織をあまり意識しなくて良いと言ったほうが正しいかもしれない。サービスとそれをメンテするチームがあるだけ、って感じ。
<ul>
<li>横のサービスが気になったら勝手に gofmt かけてプルリク出すと喜ばれる、みたいな。</li>
<li>すべてのサービスは一個のリポジトリで管理されているので、権限的に見れないみたいなことが起こらないのも大きいかもしれない。</li>
</ul>
</li>
<li>数ヶ月に渡る結構長い育休とっている男性もそこそこの数いたりして、子育て的なところにも理解があるように見えるのも嬉しい。</li>
</ul>
<h3 id="ネガティブポイント">ネガティブポイント</h3>
<ul>
<li>謎の略語が多い (ATI、KSK、フィジビリ？) 。何度「それなんでしたっけ？」って聞き返してしまったことか…。</li>
<li>プロダクトがまあまあ大きいのに、ちゃんとメンテされたドキュメントみたいなものは皆無なのは新人にはツライと感じた。ER 図みたいなものとかモジュール構成図とかね。ドキュメントの面倒を見続けるのは大変だというのは分かりつつ…。</li>
<li>会議室が足りなくてフリースペース的なところで軽いミーティングをすることがしばしばあるが、周りでも同じことをやってるので騒音にさらされることを免れ得ない。もうミーティングは全部オンラインでやったらいいんだ…。</li>
<li>巨大なミーティング (キックオフみたいの) が何となく多い？これも YouTube で配信とかにしてくれたらいいんだ…。
<ul>
<li>とはいえ、キックオフの感想で愚痴を書いたら社長から返事がきたりする一面もあり、嬉しいところもある。</li>
</ul>
</li>
<li>職場の近くの飲食店、美味しいところが多いので無限に金を吸われてしまうし、その結果、自分の体は無限に炭水化物と脂を吸い込んでしまう。</li>
</ul>
<p>ササッと並べてみたがこんなもんだろうか。ネガティブも並べてみたけれど &ldquo;強いて言うなら&rdquo; みたいな項目であり、あんまりネガティブなところ思いつかないのである。言うほど不満ないんだろうか…？不満ないとかありえる…？</p>
<h2 id="be-the-worst-ってやつよ">Be the Worst ってやつよ</h2>
<p>そういえば、自分のスキルセット (私はもともと組み込みソフトウェア開発をしていた、C/C++ で) は現職では結構役に立ってない印象で、Rails？slim？React？ああ何度も入門してます！みたいなノリで始まったのであるが、三ヶ月経った今でもそれほど変わってないようなところもある。おいおい 3 ヶ月たってそれって大丈夫かよ、おいら死ぬわ…。<br>
現チームでウェブ開発のことを最も分かっていないのはきっと自分であろうと思うんだけどね。足の引っ張り具合がちょっとツライと感じるものの、どっかの本だか記事だか (<a href="https://www.amazon.co.jp/dp/B01IGW5MQ0/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1">情熱プログラマー (アマゾンリンク)</a> だったかな？) に「Be the Worst」って言葉が出てきたのを思い出し。耐えればきっと自身の技術の向上もあろうと信じて、もう少し周りの人にも耐えてもらいつつ。食費を抑えつつ、引き続き頑張って行こうと思いました。まる。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2019-06-20 14:52:59</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2019/06/20/golangtokyo-25/">golang.tokyo #25 @ Wantedly</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>2019 年 6 月 18 日 (火) に行われた golang.tokyo #25 (@Wantdly) に参加しました。</p>
<p>イベントページはココ</p>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://golangtokyo.connpass.com/event/133581/" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">golang.tokyo #25 (2019/06/18 19:00〜)</span></div><div style="min-height:100px;"><div style="float:left;width:100px;height:100px;margin:0 1em 0.5em 0;position:relative;"><img src="https://images.weserv.nl/?w=100&url=https://connpass-tokyo.s3.amazonaws.com/thumbs/e2/9f/e29f60758cc8cda99c6f4b90a105d129.png" alt="thumbnail" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-50%);border:none;"/></div><div><span style="font-size:14px;font-weight:400;color:#666"># イベントについて  golang.tokyo 25回目の開催です！今回のテーマは「Go の郷に入る」。  最近 Gopher になった人も昔から Gopher やってる人も、あたらめて Go を見直し Go に入り直してみましょう！  # golang.tokyo って？  プログラミング言語のGoの導入企業のメンバーが集まり、Goの普及を推進するコミュニティです。 トークイベント、ハンズオン、etcのイベントを開催していく予定です！  # LT 参加者募集  申し込みフォーム  6/11まで、LT参加者を募集しています。  内容はGoに関連することであれば自由です。  3枠あり、枠...</span><br/><span style="font-size:12px;font-weight:400;color:#373">https://golangtokyo.connpass.com/event/133581/</span></div></div></a></blockquote>
<p>ツイッターはハッシュタグ「#golangtokyo」で検索すると、当日の実況ツイートの様子が分かります。<br>
<a href="https://twitter.com/search?q=%23golangtokyo%20since%3A2019-06-17%20until%3A2019-06-19&amp;src=typed_query&amp;f=tweets">ツイッター検索 (#golangtokyo since:2019-06-17 until: 2019-06-19)</a></p>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-25/01.jpg><img src=/images/golang.tokyo-25/01.jpg /></a>
  <div class="caption">こういったネームカードをぶら下げての参加 (後ほど返却)</div>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-25/02.jpg><img src=/images/golang.tokyo-25/02.jpg /></a>
  <div class="caption">おしゃれな軽食を振る舞っていただく</div>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-25/03.jpg><img src=/images/golang.tokyo-25/03.jpg /></a>
  <div class="caption">アルコールの類も少々</div>
</div>
<p>セッション 2 つ。</p>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://docs.google.com/presentation/d/117AECfnKnKALyxHXQ0ap5yJjhB6fvg1LrGYKLagaP48/edit?usp=embed_facebook" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">今改めて読み直したい Go基礎情報 その1</span></div><div style="min-height:100px;"><div style="float:left;width:100px;height:100px;margin:0 1em 0.5em 0;position:relative;"><img src="https://images.weserv.nl/?w=100&url=https://lh6.googleusercontent.com/B_pN3FJk4vwflX08-M0YPPHUhZvWnIzwmnJR5hDlpxYD17EQXPgb5sU0LrxhsKU5IKru5g=w1200-h630-p" alt="thumbnail" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-50%);border:none;"/></div><div><span style="font-size:14px;font-weight:400;color:#666">今改めて読み直したい Go基礎情報 その1 2019/06/18 golang.tokyo #25 Yoichiro Shimizu @budougumi0617</span><br/><span style="font-size:12px;font-weight:400;color:#373;word-wrap:break-word">https://docs.google.com/presentation/d/117AECfnKnKALyxHXQ0ap5yJjhB6fvg1LrGYKLagaP48/edit?usp=embed_facebook</span></div></div></a></blockquote>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://speakerdeck.com/izumin5210/golang-dot-tokyo-number-25" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">今あらためて読み直したい Go 基礎知識 その2 / golang.tokyo #25</span></div><div style="min-height:100px;"><div style="float:left;width:100px;height:100px;margin:0 1em 0.5em 0;position:relative;"><img src="https://images.weserv.nl/?w=100&url=https://speakerd.s3.amazonaws.com/presentations/b36992074ba343ada06059e73a02a583/slide_0.jpg?523374" alt="thumbnail" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-50%);border:none;"/></div><div><span style="font-size:12px;font-weight:400;color:#373;word-wrap:break-word">https://speakerdeck.com/izumin5210/golang-dot-tokyo-number-25</span></div></div></a></blockquote>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-25/04.jpg><img src=/images/golang.tokyo-25/04.jpg /></a>
  <div class="caption">発表に対して質問をした報酬にステッカーをいただけた。嬉しい</div>
</div>
<p>LT は 3 つ。</p>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://l0w.dev/posts/golang-binary-hacks/" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">golang binary hacks (golang.tokyo #25)</span></div><div><div><span style="font-size:14px;font-weight:400;color:#666">今日は golang.tokyo #25 というイベントにお邪魔して LT 枠で「golang binary hacks」というお題のお話をしてきました。 現地でお話を聞いてくださったみなさま、</span><br/><span style="font-size:12px;font-weight:400;color:#373;word-wrap:break-word">https://l0w.dev/posts/golang-binary-hacks/</span></div></div></a></blockquote>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://speakerdeck.com/mackee/i-need-detect-to-conflicts-of-identifier-for-go" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">package名と変数名がかぶっているのをとにかく検出したい / I need detect to conflicts of identifier for Go</span></div><div style="min-height:100px;"><div style="float:left;width:100px;height:100px;margin:0 1em 0.5em 0;position:relative;"><img src="https://images.weserv.nl/?w=100&url=https://speakerd.s3.amazonaws.com/presentations/54a5494c76d64f098808f28699259382/slide_0.jpg?523346" alt="thumbnail" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-50%);border:none;"/></div><div><span style="font-size:12px;font-weight:400;color:#373;word-wrap:break-word">https://speakerdeck.com/mackee/i-need-detect-to-conflicts-of-identifier-for-go</span></div></div></a></blockquote>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://speakerdeck.com/po3rin/consider-a-test-of-image-processing-in-go" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">Consider a test of image processing in Go</span></div><div style="min-height:100px;"><div style="float:left;width:100px;height:100px;margin:0 1em 0.5em 0;position:relative;"><img src="https://images.weserv.nl/?w=100&url=https://speakerd.s3.amazonaws.com/presentations/34747fe0aeca42b3b17b1470ee98b9cf/slide_0.jpg?521793" alt="thumbnail" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-50%);border:none;"/></div><div><span style="font-size:14px;font-weight:400;color:#666">Goによる画像処理テストを考察した話</span><br/><span style="font-size:12px;font-weight:400;color:#373;word-wrap:break-word">https://speakerdeck.com/po3rin/consider-a-test-of-image-processing-in-go</span></div></div></a></blockquote>
<p>会場は 100 人弱くらいの入りでとても盛況。<br>
例によって参加枠よりも多い応募があったようで、相変わらずの人気勉強会ですな。</p>
<p>今回のセッションのテーマは「Go の郷に入る」。<br>
しばしば「Go らしい/らしくないコード」なんて表現されることもある気がする昨今であるが、さて実際「Go らしさ」とは一体なんなのよ？というのを、原典を当たることで振り返っていこうという回。</p>
<p>Go が出始めたばかりの頃の設計を紹介している記事やスライドがいくらか紹介されていったが、一環して「Go は当初から今まで基本的なポリシーを変えていない」ということが強調されていたように感じた。実際、2013 年のあたりに書かれたコーディングのベストプラクティスが今見ても古臭くないというというのは結構すごいことなのではないだろうか。<br>
とはいえ Go はまだ若い部類の言語かと思われるので、今後もこのシンプルさが保っていけるのかっていうのは気になるところ。ぜひ Go らしさを保っていってほしい…！</p>
<p>ところで、「みんなの Go 言語」が改定されて第 2 版がでるという話題が出ていた。<br>
第 1 版には、本当に「いますぐ役立つ！」という感じの記事が並んでいたので、第 2 版にも期待である。</p>
<blockquote class="blogcard" style="width:auto;border:1px solid #aaa;margin:1em 0;padding:1em;line-height:1.4;text-align:left;background:#fff;"><a href="https://gihyo.jp/book/2019/978-4-297-10727-7" target="_blank" style="display:block;text-decoration:none;"><div style="width:100%;margin-bottom:0.5em;"><span style="font-size:18px;font-weight:700;color:#333">改訂2版 みんなのGo言語</span></div><div style="min-height:100px;"><div style="float:left;width:80px;height:100px;margin:0 1em 0.5em 0;position:relative;"><img src="https://images.weserv.nl/?w=100&url=https://image.gihyo.co.jp/assets/images/cover/2019/thumb/TH300_9784297107277.jpg" alt="thumbnail" style="position:absolute;top:50%;left:50%;transform: translate(-50%,-50%);border:none;"/></div><div><span style="font-size:12px;font-weight:400;color:#373;word-wrap:break-word">https://gihyo.jp/book/2019/978-4-297-10727-7</span></div></div></a></blockquote>

                    </div>
                </section>
                
                <div class="content-subhead">2019-05-31 10:50:59</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2019/05/31/job-change/">Quipper に転職した</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>2019 年 5 月、令和が始まるタイミングで転職した。<br>
ACCESS → Quipper 。今度は Web Developer として主に Rails 等を触っていく仕事をする予定。</p>
<p>入って概ね一ヶ月が経ったが戦力には程遠くて結構あれな気持ちにはなっているものの、<br>
急に何もかもが分かるようになるのは難しいし、徐々に馴染んでいくしかないと思っているところ。</p>
<p>ところで、新職場には「オンボーディング」と呼ばれる、新しく入った人が早く成果をあげられるようにするための訓練プログラム (？) のようなものがなんとなく整備されている。<br>
そういった試みは前職にはなかったので、まずそれがあるだけでそれなりに感動であった。オンボーディングの内容自体はまだ練り上げている段階のようなので、せっかくの貴重なオンボーディング体験チャンス (当然だけど入社した直後しか体験する機会がない) であるから、よりよいオンボーディングを作る、みたいな文脈でも貢献していけたら良いなぁ等と思ったり。</p>
<p>Ruby / Rails に関しては未経験ではないものの、もうすっかり忘れていて戦闘能力が 0 になっている。<br>
改めて勉強し直しているが、まあ難しいこと難しいこと。全部黒魔法に見えてくる。そのうち自分にも黒魔法が使える日が来ると信じる。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2019-04-24 14:52:59</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2019/04/24/golangtokyo-23/">golang.tokyo #23 @ DeNA</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>2019 年 4 月 19 日 (金) に行われた golang.tokyo #23 (@DeNA) に参加ました。</p>
<p>イベントページはココ<br>
<a class="embedly-card" data-card-controls="0" href="https://golangtokyo.connpass.com/event/126673/">golang.tokyo #23 (2019/04/19 19:10〜)</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<p>ツイッターはハッシュタグ「#golangtokyo」で検索すると、当日の実況ツイートの様子が分かります。<br>
<a href="https://twitter.com/search?f=tweets&amp;q=%23golangtokyo%20since%3A2019-04-19%20until%3A2019-04-23&amp;src=typd">ツイッター検索 (#golangtokyo since:2019-04-19 until: 2019-04-23)</a></p>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-23/03.jpg><img src=/images/golang.tokyo-23/03.jpg /></a>
  <div class="caption">会場ではベイスターズ的アルコール飲料が振る舞われました</div>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-23/02.jpg><img src=/images/golang.tokyo-23/02.jpg /></a>
  <div class="caption">軽食 (ベイスターズ的アルコール飲料に合う) も振る舞われました</div>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-23/01.jpg><img src=/images/golang.tokyo-23/01.jpg /></a>
  <div class="caption">golang.tokyo #23 開幕</div>
</div>
<p>今回のテーマは「これから Go を始める人に知ってほしいこと」。<br>
(実際に用いられた資料はイベントページを参照されたし)</p>
<p>当日使われた全ての資料のいくらかはまだ connpass のイベントページに載っていないようなので、一応本記事でもリストアップしておきます。<br>
(以下、登壇順)</p>
<ul>
<li>セッション
<ul>
<li><a href="https://docs.google.com/presentation/d/1u93oMe7QForbqrCwGE2lHbu99t4I9_m5IzfeYETD7BU/edit#slide=id.p">絶対に分かるポインタ</a> by <a href="https://twitter.com/tenntenn">tenntenn</a> さん</li>
<li><a href="https://speakerdeck.com/mom0tomo/golang-tokyo-go-tools">Go をはじめるにあたって知っておいてほしいツール</a> by <a href="https://twitter.com/mom0tomo">mom0tomo</a> さん</li>
<li><a href="https://speakerdeck.com/mishirakawa/golang-dot-tokyo-number-23">Go をはじめるにあたって知っておいてほしいツールやテスト</a> by <a href="https://twitter.com/micchiebear">micchie</a> さん</li>
<li><a href="https://speakerdeck.com/xruins/delvewoyong-itadebatugu-and-pprofwoyong-itapurohuairingu">Delve を用いたデバッグ &amp; pprof を用いたプロファイリング</a> by <a href="https://twitter.com/C_Ruins">C_Ruins</a> さん</li>
</ul>
</li>
<li>ライトニングトーク
<ul>
<li><a href="https://speakerdeck.com/shoheshohe/godoctotddnidaibusitaratuo-xin-ren-woshi-merareru-hua">GoDoc と TDD にダイブして脱新人を始められる？話</a> by <a href="https://twitter.com/PGShohei">PGShohei</a> さん</li>
<li><a href="https://speakerdeck.com/horiryota/gorasisatogo-generate">Go らしさと go generate</a> by <a href="https://twitter.com/hori_ryota">hori_ryota</a> さん</li>
<li><a href="https://speakerdeck.com/micnncim/goreleaser-release-and-distribute-go-application">GoRelaesr: Release and Distribute Go Application</a> by <a href="https://twitter.com/micnncim">micnncim</a> さん</li>
</ul>
</li>
</ul>
<p>DeNA のイベントスペースらしきところでの開催であり、100 人弱くらいは集まっていたんではなかろうか。</p>
<p>golang.tokyo は今回で 23 回目。いつも定員オーバーになるくらいの人気な勉強会です。<br>
今回も 74 の参加枠に対して 124 もの応募があった様子。人気。とても人気。</p>
<p>だので普通に参加しようと思ったら概ねの場合は抽選になってしまいますが、「ブログ枠」という「イベントの様子をブログにしたためてくれるなら参加していいよ」枠が存在します。<br>
私もしばしばこれで参加しています。この枠だと早いもの勝ち、かつ何故か人気がない (いつもだいたい空いている) ので、参加したいが抽選にあぶれたくない人はトライしてみるのも良いのではないかと思います。</p>
<p>さて勉強会の様子。<br>
今回は「これから Go を始める人に知っておいてほしいこと」ということで、セッションの内容はどちらかと言うと基礎的な内容でした。<br>
Go の初学者の方にはもちろん有用であると思いますし、Go をやりこんでいる人にとっても諸々再確認できて非常に有意義な会だったと感じました。</p>
<p>前半のツール紹介は、主に Go 公式から提供されているツール類の紹介、ならびに使い方の説明でしたが、このツール類の充実っぷりは Go の特徴かと思っています。<br>
便利ツールの諸々が野良の OSS じゃなくて公式から提供されているっていうのは安心感あるよね！ということで、知っておいてほしいツール類、必見です。</p>
<p>ライトニングトーク一発目の PGShohei さんは、今回が人生で初めてのライトニングトークだったとのこと。<br>
初めてとは思えない発表クオリティにびびりつつ、その挑戦していく心意気には目頭が熱くなる思いでありました。<br>
今回で 23 回目を数える golang.tokyo ですが、常連もいつつ、一方で新しいひともいつつ、という感じで広く門戸が開かれていると感じた会でした。</p>
<p>そんな golang.tokyo ですが、次回開催 (#24) が既に告知されています (2019/05/02 現在、まだ募集を開始していません) 。<br>
<a class="embedly-card" data-card-controls="0" href="https://golangtokyo.connpass.com/event/129067/">golang.tokyo #24 (2019/05/20 19:10〜)</a></p>
<p>次回は Go Conference 2019 に参加できなかった勢が主なターゲット (いわゆる RejectCon) であるようなので、また濃い話が聞けるのではないかと思います。楽しみですね！<br>
参加者募集開始のアナウンスなどは <a href="https://twitter.com/golangtokyo">golang.tokyo 公式ツイッターアカウント</a> をウォッチしていれば良いと思います。</p>
<p>最後に、ブログ枠なのにブログ書くの遅くなってほんとすんません&hellip;！イベントから二週間くらい経っちゃってますな…。<br>
ちなみに次回の golang.tokyo #24 では「ツイッター実況枠」というのが設けられたようなので (その代わりブログ枠はなくなった) 、ツイッターの腕に覚えのある方はトライしてみてもいいんじゃないかなと思います。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2018-07-13 19:15:16</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2018/07/13/golangtokyo-16/">golang.tokyo #16 @メルペイ</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="https://golangtokyo.connpass.com/event/92225/">golang.tokyo #16 @メルペイ</a>に参加。<br>
本日は wasm がメインテーマ。発表者と資料は末尾に記載。</p>
<h2 id="そもそも-wasm-webassembly-とは何か">そもそも wasm (WebAssembly) とは何か</h2>
<p>以下は公式サイト。webassembly.org。<br>
<a class="embedly-card" data-card-controls="0" href="https://webassembly.org/">WebAssembly</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<p>公式ページからの説明を引用すると以下のように書かれている。</p>
<p><em>WebAssembly (abbreviated Wasm) is a binary instruction format for a stack-based virtual machine. Wasm is designed as a portable target for compilation of high-level languages like C/C++/Rust, enabling deployment on the web for client and server applications.</em></p>
<p>C/C++/Rust 等で作ったバイナリをウェブブラウザ上で動かすための規格、くらいに捉えれば良かろうか。<br>
公式を含む各所の記事をあたってみると、wasm の存在意義としては基本的には JavaScript から比較しての軽量化、高速化である模様。</p>
<h2 id="go-の-wasm-サポート">Go の wasm サポート</h2>
<p>Go 言語も wasm へのビルド (トランスパイル) を Go 1.11 からサポートする予定であり、2018/07 現在は tip (Go の master のさきっちょ) を使うことで機能を試すことができる。<br>
ちなみに Go 1.11 は、2018/08 にリリース予定。</p>
<h2 id="go-から-wasm-をビルドしてみる">Go から wasm をビルドしてみる</h2>
<p>たとえば以下のいわゆるハローワールド的なコードも wasm 向けにビルドできるようになる。</p>
<pre><code>package main

import &quot;fmt&quot;

func main() {
    fmt.Println(&quot;Hello world!&quot;)
}
</code></pre><p>wasm 向けのビルドは以下のようなコマンドで行う。<br>
(上記のソースが main.go として存在していると仮定)</p>
<pre><code>$ GOOS=js GOARCH=wasm go build -o hello.wasm main.go
</code></pre><h2 id="生成した-wasm-の動作確認まで">生成した wasm の動作確認まで</h2>
<p>動作を確認するためにはもういくつかファイルが必要であり、Go のリポジトリからコピーしてくる必要がある。<br>
GitHub に curl を飛ばしても取得できる。</p>
<p>ビルドと必要なファイルを揃える処理を一式 Makefile で書くと以下のような感じになる。</p>
<pre><code>WASM = test.wasm
HTML = wasm_exec.html
JS   = wasm_exec.js
CLEAN_TARGET = $(WASM) $(HTML) $(JS)

all: $(WASM) $(HTML) $(JS)

$(WASM):
	GOOS=js GOARCH=wasm go build -o test.wasm main.go

$(HTML):
	curl -sO https://raw.githubusercontent.com/golang/go/master/misc/wasm/wasm_exec.html

$(JS):
	curl -sO https://raw.githubusercontent.com/golang/go/master/misc/wasm/wasm_exec.js

clean:
	rm -f $(CLEAN_TARGET)
</code></pre><p>一式そろうと以下のようになる。</p>
<pre><code>$ ls
main.go  Makefile  server.go  test.wasm  wasm_exec.html  wasm_exec.js
</code></pre><p>この状態で wasm_exec.html を何らかの HTTP Server でサーブすると、なんとなく Console に Hello world 的な文字がでることが確認できる。<br>
ちなみに file:/// で wasm_exec.html をサーブしても正しく動作しない場合があるようで、これは Chrome が file スキームで読み込んだ HTML ファイルだと JavaScript を実行してくれないためである模様。</p>
<p>上記までを一式納めたものは以下のリポジトリに置いておいた。<br>
<a href="https://github.com/pankona/go-wasm-test">https://github.com/pankona/go-wasm-test</a></p>
<h2 id="各セッションを聞いて">各セッションを聞いて</h2>
<p>golang.tokyo#16 の各セッションを聞いての留意点としては、</p>
<ul>
<li>ベンチマークをとると、Go を JS にトランスパイルする GopherJS のほうがパフォーマンスが出る。wasm の最適化は今後の課題 (Go 1.12 以降？)
<ul>
<li>Chrome で動かす JS がやたら速いという一面も</li>
</ul>
</li>
<li>Empscripten (C++ から wasm を作るやつ) が比較的速い</li>
<li>Go から作った wasm はまだバイナリサイズが大きい (2MB〜) という面があり、この点も今後の最適化が待たれるところ</li>
</ul>
<h2 id="色々まだまだな-go-の-wasm-サポートとはいえ">色々まだまだな Go の wasm サポートとはいえ</h2>
<p>ベンチマーク、バイナリサイズなどはまだ改善の余地があるとはいえ、超絶お手軽なクロスコンパイルは快適そのもの。<br>
まだ出てきたばかり (出てきてすらいないか) なので、今後に大いに期待である。</p>
<p>以下、各セッションの資料を記載。</p>
<h2 id="session1-webassemblyとgoの対応状況について-by-tenntennhttpswwwtwittercomtenntenn-さん">(Session1) WebAssemblyとGoの対応状況について by <a href="https://www.twitter.com/tenntenn">tenntenn</a> さん</h2>
<ul>
<li>
<p>(TODO: 2018/07/17現在、発表資料がへのリンクが見当たらないので、後々更新)</p>
</li>
<li>
<p>goroutine と channel には対応。wasm にマルチスレッドの機能が入るらしい。</p>
</li>
<li>
<p><a href="syscall/js">https://tip.golang.org/pkg/syscall/js</a> を使う</p>
</li>
</ul>
<h2 id="session2-gopherjs-vs-goarchwasm-by-hajimehoshihttpswwwtwittercomhajimehoshi-さん">(Session2) GopherJS vs GOARCH=wasm by <a href="https://www.twitter.com/hajimehoshi">hajimehoshi</a> さん</h2>
<p><a class="embedly-card" data-card-controls="0" href="https://docs.google.com/presentation/d/e/2PACX-1vQLOcSY-SpdWedMT48QFZ8f9T_XojfqUOCgMg4jqIz8cJjFIJhHm98gHKVyMaboqGpsXCfedplT-lmp/pub?start=false&loop=false&delayms=3000#slide=id.p">GopherJS vs GOARCH=wasm</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<p>以下、ライトニングトーク。</p>
<h2 id="lt1-go-で社内向け管理画面を楽に作る方法-by-yudppphttpswwwtwittercomyudppp-さん">(LT1) Go で社内向け管理画面を楽に作る方法 by <a href="https://www.twitter.com/yudppp">yudppp</a> さん</h2>
<p><a class="embedly-card" data-card-controls="0" href="https://speakerdeck.com/yudppp/godeshe-nei-xiang-keguan-li-hua-mian-wole-nizuo-rufang-fa">Goで社内向け管理画面を楽に作る方法</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<ul>
<li>Go 歴 4 年の方。</li>
<li>Viron を使って自社向けサービスの管理画面を自動生成する話。</li>
</ul>
<h2 id="lt2-go-のスライス容量拡張量がどのように決まるのか-by-kaznishi1246httpswwwtwittercomkaznishi1246-さん">(LT2) Go のスライス容量拡張量がどのように決まるのか by <a href="https://www.twitter.com/kaznishi1246">kaznishi1246</a> さん</h2>
<p><a class="embedly-card" data-card-controls="0" href="https://speakerdeck.com/kaznishi/180713-lt">Goのスライス容量拡張量がどのように決まるのか追った / 180713 LT</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<ul>
<li>Go 歴 1 ヶ月の方とのこと。1 ヶ月で LT しにくるの強い。</li>
<li>メモリ確保量によってクラス分けされている。</li>
<li>TCMalloc がメモリ確保量を切り上げる動作をする。</li>
</ul>
<h2 id="lt3-go言語の正規表現に後読みを実装した話-by-さっき作ったhttpswwwtwittercommake_now_just-さん">(LT3) Go言語の正規表現に後読みを実装した話 by <a href="https://www.twitter.com/make_now_just">さっき作った</a> さん</h2>
<p><a class="embedly-card" data-card-controls="0" href="https://slides.com/makenowjust/regexp-lookbehind-in-golang#/">Go言語の正規表現に後読みを実装した話</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<ul>
<li>いまのところまだマージされていないが、上記は既に実装して Gerrit にてレビュー中。</li>
<li>マージされたら嬉しいね！</li>
</ul>

                    </div>
                </section>
                
                <div class="content-subhead">2018-06-23 17:00:42</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2018/06/23/mashimahi/">強いパスワードのためのフレーズジェネレータを作ってみた</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>ふと思い立って、フレーズジェネレータなるものを作ってみた。</p>
<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">こないだ作ってみた「強そうなパスフレーズ/パスワード生成器 (PhraGen)」に CSS をあててちょっとオシャレにしといたぞ。無駄に日本語への自動翻訳もつけておきたかったが、翻訳部分は無料ではいまいち達成できなそうかなー。<a href="https://t.co/tThQl1mfSe">https://t.co/tThQl1mfSe</a></p>&mdash; パン粉 (@pankona) <a href="https://twitter.com/pankona/status/1010435240714633216?ref_src=twsrc%5Etfw">2018年6月23日</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>GAE/Go で作成。<a href="https://strongest-mashimashi.appspot.com/">ココ</a> にホスティング。PhraGen (ふらげん) と命名。</p>
<h2 id="これは何か">これは何か</h2>
<p>どこかで聞いた話であるが、いわゆる「強いパスワードというのはどうやって生成するのが良いのか」ということを考えた時に、<br>
ひとつの手法として**「英語の辞書からランダムで 3 単語ひっぱってきてつなげるのが良い」**というのがあると小耳に挟んだわけである。</p>
<p>なるほどなるほど、ということで、では試しに作ってみようということで作ってみたのがこれである。</p>
<h2 id="ちょっとした工夫">ちょっとした工夫</h2>
<p>完全にランダムな単語をチョイスしたほうがパスワード的には強いのだろうけど、きっとそれは覚えにくいフレーズになってしまうと思われる。<br>
ということで、ちょっとでも覚えやすいフレーズを生成するために、完全にランダムなチョイスではなく**「形容詞＋形容詞＋名詞」**の順で現れるフレーズを生成するようにしてみた。<br>
**Super Great Goalkeeper** 的なものが生成されることをイメージしている。</p>
<h2 id="ジェネレータのしくみなど">ジェネレータのしくみなど</h2>
<h3 id="oxford-dictionaries-api">Oxford Dictionaries API</h3>
<p>そもそも英語の辞書のデータをどのように扱えば良いのか。出どころはどこか、ということを探していると以下を見つけた。</p>
<p><a class="embedly-card" data-card-controls="0" href="https://developer.oxforddictionaries.com/">Oxford Dictionaries API</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<p>これは英語辞書で有名な Oxford が提供してくれている (と思われる)、Web API である。<br>
REST API の形をしていて (なんと Swagger の定義までついている)、ドキュメントの記載通りに叩くことで単語とその意味などを得ることができる。<br>
形容詞で、&ldquo;super で始まる&rdquo; 5字以上の単語、みたいなクエリでワードリストを取得できるような機能が提供されている。</p>
<p>これを利用しようということで、まずは提供されている swagger の定義をありがたくお借りしてクライアントライブラリを生成した。<br>
以下のリポジトリに置いておいた。またいつか使うかもしれない。</p>
<p><a class="embedly-card" data-card-controls="0" href="https://github.com/pankona/oxford-dict-api-client-go">pankona/oxford-dict-api-client-go</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<h3 id="レスポンス遅いけどキャッシュは規約違反">レスポンス遅いけどキャッシュは規約違反</h3>
<p>ただ、一回のクエリに数秒かかるようなところがあり、PhraGen の裏で動かすにはちょっとしんどい一面がある。<br>
3 単語から構成されるフレーズを作るということは 3 回リクエストするということであり、つまり 1 フレーズ生成につき 5〜6 秒は待たされてしまう。</p>
<p>問い合わせてみたところ、規約上、フリーのプランでは Oxford Dictionaries API が吐き出す結果をキャッシュしておくことは禁止とのこと。<br>
お金を払えば制限つきでキャッシュしておけるということで、検討されたしとのお達しであった。うーむ…。<br>
※ この点については、近日中にバイオレーションのない形に変更予定。</p>
<h3 id="ホスティングは-gaeバックエンドは-go">ホスティングは GAE、バックエンドは Go</h3>
<p>ジェネレータは GAE/Go で作った。ソースコードは以下のリポジトリに格納。</p>
<p><a class="embedly-card" data-card-controls="0" href="https://github.com/pankona/strongest-mashimashi">pankona/strongest-mashimashi</a></p>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
<p>リポジトリ名に深い意味はなく、なんとなく語呂が良いのでつけておいた。ストロンゲストマシマシ。</p>
<h3 id="フロントエンドは色々">フロントエンドは色々</h3>
<p>フロントエンド力がナメクジレベルのパン粉であるが、色々調べつつ、以下の技術要素の利用を試みている。<br>
特に CSS フレームワーク Bulma のおかげで、PhraGen はまあまあしゃらくさい感じのキレイな見た目になったのではないかと思っている。</p>
<ul>
<li>TypeScript</li>
<li>React</li>
<li>CSS フレームワークとして Bulma</li>
</ul>
<h3 id="使えるのか">使えるのか</h3>
<p>使えるかどうかよりもそもそも使わなそう。<br>
でもせっかく作ったので、実際にパスワードの生成のために使ってみる所存。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2018-05-30 19:39:48</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2018/05/30/golangtokyo-15/">golang.tokyo #15@DeNA</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="https://golangtokyo.connpass.com/event/87064/">golang.tokyo #15</a>に参加してきた。<br>
内容は以下。</p>
<ul>
<li>メインの30分セッションふたつ
<ul>
<li>Effective Streaming in Golang by <a href="https://twitter.com/avvmoto">avvmoto</a> さん</li>
<li>次世代のコンテナランタイム！？gVisorのコードを読みながら理解してみる by <a href="https://twitter.com/niconegoto">niconegoto</a> さん</li>
</ul>
</li>
<li>ライトニングトークは発表予定の 2 人が都合が悪くなってしまったらしく、急遽代打を現地で 2 名補充</li>
</ul>
<h2 id="effective-streaming-in-golang-by-avvmotohttpstwittercomavvmoto-さん">Effective Streaming in Golang by <a href="https://twitter.com/avvmoto">avvmoto</a> さん</h2>
<div style="max-width: 800px">
<script async class="speakerdeck-embed" data-id="3431ee80147b48b2beabf723612382e5" data-ratio="1.41436464088398" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-15/10.jpg><img src=/images/golang.tokyo-15/resized_10.jpg /></a>
  <div class="caption">avvmoto さんの発表。io package を使いこなして無駄をなくそう！</div>
</div>
<p>何かデータを読み込んでそれを引き回そうというときに、<strong>読み取り時にメモリ上に確保し、 確保したメモリを引き回す</strong>とやってしまうと、関数をまたぐたびにコピーが発生してしまう (もしくはポインタで渡していくか) みたいなことが起きがちである。<br>
io.Reader interface を引き回すことで、<strong>いざ実際に必要になった段で初めてメモリ上に読み込む</strong>ような動作にでき、メモリ効率、処理速度の向上に寄与できるんじゃない、という話だったと理解した。</p>
<h2 id="次世代のコンテナランタイム-gvisor-を理解する-by-niconegotohttpstwittercomniconegoto-さん">次世代のコンテナランタイム gVisor を理解する by <a href="https://twitter.com/niconegoto">niconegoto</a> さん</h2>
<div style="max-width: 800px">
<script async class="speakerdeck-embed" data-id="648504c5f1724ee5b97d1f14ca12a4cb" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-15/08.jpg><img src=/images/golang.tokyo-15/resized_08.jpg /></a>
  <div class="caption">noconegoto さん。</div>
</div>
<p>gVisor はよりセキュアにコンテナの仕組みを使おうということで出てきたプロダクトの模様。<br>
Google においては、gVisor についていずれ論文で技術的な詳細をつまびらかにする予定があるらしく、出てきたら読んでみようかなと思う。<br>
ちなみに、<a href="https://github.com/google/gvisor">gVisor のソースコード</a>は既に20万行くらいになっているらしく、なかなかゴツいっすね…。</p>
<p>暫時休憩を挟み。</p>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-15/03.jpg><img src=/images/golang.tokyo-15/resized_03.jpg /></a>
  <div class="caption">軽食のミニチキンカツサンド。本日も色々いただきました。ありがとうございました。</div>
</div>
<p>以下、ライトニングトーク。</p>
<h2 id="lt-by-yoshi_xxxxxiiiihttpstwittercomyoshi_xxxxxiiii-さん-from-cluex">LT by <a href="https://twitter.com/yoshi_xxxxxiiii">@yoshi_xxxxxiiii</a> さん from Cluex</h2>
<div style="max-width: 800px">
<script async class="speakerdeck-embed" data-id="e4a3aaa06df042cbbcd90cd215ec858d" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-15/04.jpg><img src=/images/golang.tokyo-15/resized_04.jpg /></a>
  <div class="caption">yoshi_xxxxxiiii さん。アゴヒゲキンパツの二つ名があるとのこと。</div>
</div>
<ul>
<li>「mamanoko」「ままのて」というサービスを運営されているとのこと。</li>
<li>せっかく実装したローディング画面について、サーバが JSON 返すの速くなりすぎてローディング画面が出ない、という苦情があったらしい。すごいね。</li>
</ul>
<p>しばしば Rails と Go は比較に上がる気がする。Go に一部変えたら速くなりました！みたいな。<br>
Rails だから遅いってこともないという認識だけど、速くしようと思ったら大変ってことなのかなー。</p>
<h2 id="lt-by-pospomehttpstwittercompospome-さん">LT by <a href="https://twitter.com/pospome">@pospome</a> さん</h2>
<ul>
<li>急遽代打で登壇。</li>
<li>技術書典で golang.tokyo が出した本に寄稿した内容の紹介</li>
</ul>
<h2 id="lt-by-karupanerurahttpstwittercomkarupanerura-さん">LT by <a href="https://twitter.com/karupanerura">@karupanerura</a> さん</h2>
<ul>
<li>こちらも急遽代打で登壇。</li>
<li>以下の記事について解説。<br>
<a class="embedly-card" href="https://qiita.com/karupanerura/items/fa3b35dfdceb96730b03">Goで書いたMicroservicesな構成からWeb APIを叩くときに考えたこと - Qiita</a></li>
</ul>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>

                    </div>
                </section>
                
                <div class="content-subhead">2018-04-16 19:32:07</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2018/04/16/golangtokyo-14/">golang.tokyo #14@メルカリ</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="https://golangtokyo.connpass.com/event/82723/">golang.tokyo #14</a> に参加してきたのでその内容メモ。<br>
発表内容は以下。</p>
<ul>
<li>ホリネズミでもわかる Goroutine 入門 by <a href="https://twitter.com/inukirom">@inukirom</a> さん</li>
<li>チャネルのしくみ by <a href="https://twitter.com/knsh14">@knsh14</a> さん</li>
<li>ライトニングトーク 3 つ
<ul>
<li>vgo の話 by <a href="https://twitter.com/tanksuzuki">@tanksuzuki</a> さん</li>
<li>プロダクションに Go を適用した話 by <a href="https://twitter.com/kurikazu">@kurikazu</a> さん</li>
<li>linter を作る話</li>
</ul>
</li>
</ul>
<p>例によって軽食 (と言いつつかなり十分な量の食事が) 提供されており、ありがたくいただきました…！<br>
ありがとうございました。ごちそうさまでした。</p>
<h2 id="ホリネズミでもわかる-goroutine-入門-by-inukiromhttpstwittercominukirom-さん">ホリネズミでもわかる Goroutine 入門 by <a href="https://twitter.com/inukirom">@inukirom</a> さん</h2>
<div style="max-width: 800px">
<script async class="speakerdeck-embed" data-id="5611568f65044914bb63fb0d787e0852" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-14/05.jpg><img src=/images/golang.tokyo-14/resized_05.jpg /></a>
  <div class="caption">inukirom さん発表の様子。とても丁寧でわかりやすかった。</div>
</div>
<h3 id="goroutine-と-chan-の基本的な使い方">goroutine と chan の基本的な使い方</h3>
<p>goroutine と defer と panic を組み合わせて使う場合に注意すべき点があり、<br>
たとえば以下のような場合、A 内で張った defer は呼び出されない<strong>場合がある</strong>。<br>
(スライド内では&quot;呼び出されない&quot;と書かれているが、その限りではなさそうな)</p>
<pre><code>func A() {
    defer func(){}()
    go B()
}

func B() {
    panic(&quot;panic!!&quot;)
}
</code></pre><p>状況としては、</p>
<ul>
<li><code>A()</code> が終わるよりも先に <code>B()</code> 内の <code>panic</code> が先に実行されたときは、<code>A()</code> 内の <code>defer</code> は呼び出されないまま終わる。</li>
<li><code>panic</code> よりも <code>A()</code> が終了するほうが先なのであれば、<code>defer</code> は実行される。</li>
</ul>
<h3 id="channel">channel</h3>
<p>channel については以下のような話題がとりあげられた。</p>
<ul>
<li>close は結構デリケート (使い方を誤るとすぐに動かなくなる) なので注意</li>
<li>RW、R only、W only という属性を持たせられる</li>
<li>select. default で non-blocking にできる</li>
</ul>
<p>ところで、channel は close しないでほっとくような例もよく見るのであれが、close しなくて良いのだろうか？</p>
<p><a href="https://groups.google.com/forum/#!msg/golang-nuts/pZwdYRGxCIk/qpbHxRRPJdUJ">golang-nuts でのやりとり</a> を見るにつけては、 使われなくなった channel は GC の対象になるため、あえて明示的に close する必要はないと言っている気がする。 channel を close すると受け手側にお知らせがいくので、どうやらそういう目的で使うらしい。</p>
<h3 id="wait-処理">wait 処理</h3>
<p>goroutine の終了を待ち合わせする例の紹介。</p>
<ul>
<li>channel で待つ
<ul>
<li>単なるお知らせであってお知らせ内容に意味がないのであれば、<code>struct{}{}</code> を使うのがメモリ効率が良い。</li>
</ul>
</li>
<li>sync.WaitGroup
<ul>
<li><code>sync.WaitGroup</code> で、複数の goroutine を待ち合わせしやすくなる</li>
<li><code>sync.WaitGroup</code> にエラー処理を生やしたみたいな <code>errgroup</code> なんかもある</li>
</ul>
</li>
</ul>
<h3 id="for-ループと-goroutine">for ループと goroutine</h3>
<p>for 文の中で goroutine 立てる例。よくある罠。</p>
<ul>
<li>引数に渡して何とかする例</li>
<li>競合の解決
<ul>
<li>直列でええやん、という場合もある</li>
<li>排他制御に <code>sync.Mutex</code> 使う例。<code>RWMutex</code> もあるぞ</li>
<li><code>sync/atomic</code> というパッケージもあるぞ</li>
</ul>
</li>
</ul>
<h3 id="goroutine-のリーク">goroutine のリーク</h3>
<ul>
<li>goroutine の中でブロックしちゃうと goroutine がリークする
<ul>
<li><code>context.Context</code> 等を用いると goroutine を終わらせる処理を書きやすい</li>
</ul>
</li>
</ul>
<h3 id="便利ツールの紹介">便利ツールの紹介</h3>
<ul>
<li>gotrace
<ul>
<li>goroutine と channel のやりとりを可視化できるぞ…！</li>
<li>docker image を使って動かしている</li>
</ul>
</li>
</ul>
<h2 id="チャネルのしくみ-by-knsh14httpstwittercomknsh14-さん">チャネルのしくみ by <a href="https://twitter.com/knsh14">@knsh14</a> さん</h2>
<div style="max-width: 800px">
<script async class="speakerdeck-embed" data-id="3ca3b188d9904775b4281cfee7018c27" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-14/03.jpg><img src=/images/golang.tokyo-14/resized_03.jpg /></a>
  <div class="caption">knsh14 さん発表の様子。シュラスコと寿司で例えていく。</div>
</div>
<p>以下、LT</p>
<h2 id="vgo-by-tanksuzukihttpstwittercomtanksuzuki-さん">vgo by <a href="https://twitter.com/tanksuzuki">@tanksuzuki</a> さん</h2>
<div style="max-width: 800px">
<script async class="speakerdeck-embed" data-id="08cee61b8c56450d8ef618b378fcd6a0" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-14/02.jpg><img src=/images/golang.tokyo-14/resized_02.jpg /></a>
  <div class="caption">tanksuzuki さん発表の様子。GOPATH なくなるのは胸熱。</div>
</div>
<p>vgo に関してはまだ使うのしんどい一面もあるものの、GOPATH、vendor が不要になるみたいな、Go を紹介するときに割と不評を買うところが改善されていくわけであり、今後に大いに期待である。</p>
<h2 id="プロダクションに-go-を適用した話-by-kurikazuhttpstwittercomkurikazu-さん">プロダクションに Go を適用した話 by <a href="https://twitter.com/kurikazu">@kurikazu</a> さん</h2>
<iframe src="//www.slideshare.net/slideshow/embed_code/key/lyY1i4CNbWM6jP" width="595" height="520" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen></iframe><div style="margin-bottom:5px"></div></iframe>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-14/04.jpg><img src=/images/golang.tokyo-14/resized_04.jpg /></a>
  <div class="caption">kurikazu さん発表の様子。Go 導入してハッピーなのは良いね！</div>
</div>
<h2 id="linter-を作る話-by-dice_zuhttpstwittercomdice_zu-さん">linter を作る話 by <a href="https://twitter.com/dice_zu">@dice_zu</a> さん</h2>
<p><a href="https://daisuzu.github.io/golang-tokyo-14/#1"><img src=/images/golang.tokyo-14/linter_by_dice_zu.jpg /></a></p>
<div style="margin-bottom:24px">
  <a href=/images/golang.tokyo-14/01.jpg><img src=/images/golang.tokyo-14/resized_01.jpg /></a>
  <div class="caption">dice_zu さん発表の様子。lint を比較的容易に自作できるのも Go の良いところか。</div>
</div>
<p>プロジェクト独自のコーディングルールとかがあるのであれば、チームで lint を作って運用するのもありかもしれない。<br>
個人的には named return value 禁止とかやりたいところであるが…？</p>

                    </div>
                </section>
                
                <div class="content-subhead">2018-02-05 00:38:03</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2018/02/05/droidkaigi_2018_material/">DroidKaigi 2018 向け資料 - gomobile でゲームを作る</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-DroidKaigi" href="https://pankona.github.io/categories/droidkaigi">DroidKaigi</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>DroidKaigi 2018 では以下の枠で発表する予定。</p>
<p>DAY.01 (Feb 8th, 2018) 14:00-14:30 Room 7 - <a href="https://droidkaigi.jp/2018/timetable?session=17012">gomobile でゲームを作る</a><br>
資料はココ → <a href="http://pankona.github.io/slides/droidkaigi_2018.html">gomobile でゲームは作れる</a></p>
<h2 id="発表内容についての徒然">発表内容についての徒然</h2>
<p>DroidKaigi と言うからには Androider たちの集いであることは間違いないと思うんだけど、<br>
さて、であればそもそも Go 言語が登場すること自体が結構レアな事態であり、ややもすれば<br>
聴衆は Go 言語のこと全然知らないってこともありうるんじゃないかと想像したりしている。</p>
<p>ということに鑑みて、「Go とは何か」みたいなところから話題を始めようと思っているが、<br>
だとすると 30 分ではあまり細かい話 (JNI で Toast 出すのが何故困難か、とか) まで踏み込めない構成になってしまい、<br>
なかなか悩ましいところである。ニッチ枠であるならば、もっとニッチにニッチを煮詰めたような内容にしたいのであるが…。</p>
<p>ということで、ニッチにニッチを煮詰めたような内容はブログ記事に書いておき、<br>
興味があったら見てね、みたいな感じにしとこうという結論に達した。<br>
発表内容はライトに。リンク先はもう少し深く、みたいな。</p>
<p>DroidKaigi は、実は見に行くのも初めてなので、他のセッションを聞いて廻るのも楽しみである。</p>

                    </div>
                </section>
                
                <div class="content-subhead">2018-01-31 16:30:10</div>
                <section >
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2018/01/31/gomobile_get_files_dir/">gomobile (build) で作るアプリでファイルを保存する</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-go" href="https://pankona.github.io/categories/go">go</a><a class="post-category post-category-gomobile" href="https://pankona.github.io/categories/gomobile">gomobile</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>gomobile という Go 言語で Android/iOS のアプリを作ろうというプロジェクト (準公式) が存在する。<br>
ページはココ → <a href="https://github.com/golang/go/wiki/Mobile">gomobile の公式 wiki ページ - https://github.com/golang/go/wiki/Mobile</a></p>
<p><code>gomobile build</code> コマンド一発で Go のソースから APK が生成されるというなかなか豪快なコマンドなのであるが、<br>
いかんせん色々制限があって、いざ何か作ってみようとするとまあまあハマる。<br>
どんな苦行があるかは <a href="https://qiita.com/pankona/items/11941a5cfb668e653b4a">手前味噌だが Qiita の記事</a> に何となく記しておいた。</p>
<p>上記記事には書いてなかったハマりポイントとして、**「ファイルを永続領域に保存する API がない」**というのがある。<br>
ファイルを保存できないということは、ゲーム作ってて何かセーブデータでも保存しよう、とかそういうことができないってことである。<br>
割と致命的である。</p>
<p>ただ、実は gomobile はパッケージ内に JNI を触る実装を持っていて (何故か internal パッケージなので外から触れないが) 、<br>
それを参考にすれば、cgo 経由で JNI に触ることができる。<br>
JNI に触れるということは、Java の API に触れるということで、それはすなわち Android SDK の API に触れるということである。<br>
Go から Android SDK の API に触れるのである。</p>
<h2 id="android-アプリ作成におけるファイル保存領域の取得">Android アプリ作成におけるファイル保存領域の取得</h2>
<p>ググればさっさと出てくるが、Android アプリを作る際には以下のようなコードを書くと、<br>
ファイルを永続保存できる領域へのディレクトリパスを取得できる (アプリアンインストールと共に削除される) 。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">AppCompatActivity</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">dir</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getCacheDir</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">();</span>
        <span class="c1">// dir にはファイル保存可能領域 (internal storage) への絶対パスが入る
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h2 id="gomobile-build-アプリ作成時におけるファイル保存領域の取得">gomobile (build) アプリ作成時におけるファイル保存領域の取得</h2>
<p>つまりは上記と同様の処理を JNI で書いてやれば良い。<br>
以下のようになる。</p>
<h3 id="jni-パッケージ-go言語--c言語">jni パッケージ (Go言語 + C言語)</h3>
<p>指定した関数を JNI 上で実行する関数 <code>RunOnJVM</code> を定義しているパッケージ。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// +build android
</span><span class="c1"></span>
<span class="kn">package</span> <span class="nx">jni</span>

<span class="cm">/*
</span><span class="cm">#cgo LDFLAGS: -landroid
</span><span class="cm">#include &lt;jni.h&gt;
</span><span class="cm">#include &lt;stdlib.h&gt;
</span><span class="cm">
</span><span class="cm">JavaVM* current_vm;
</span><span class="cm">jobject current_ctx;
</span><span class="cm">
</span><span class="cm">static char *
</span><span class="cm">_lockJNI(uintptr_t* envp, int* attachedp) {
</span><span class="cm">	JNIEnv* env;
</span><span class="cm">
</span><span class="cm">	if (current_vm == NULL) {
</span><span class="cm">		return &#34;no current JVM&#34;;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	*attachedp = 0;
</span><span class="cm">	switch ((*current_vm)-&gt;GetEnv(current_vm, (void**)&amp;env, JNI_VERSION_1_6)) {
</span><span class="cm">	case JNI_OK:
</span><span class="cm">		break;
</span><span class="cm">	case JNI_EDETACHED:
</span><span class="cm">		if ((*current_vm)-&gt;AttachCurrentThread(current_vm, &amp;env, 0) != 0) {
</span><span class="cm">			return &#34;cannot attach to JVM&#34;;
</span><span class="cm">		}
</span><span class="cm">		*attachedp = 1;
</span><span class="cm">		break;
</span><span class="cm">	case JNI_EVERSION:
</span><span class="cm">		return &#34;bad JNI version&#34;;
</span><span class="cm">	default:
</span><span class="cm">		return &#34;unknown JNI error from GetEnv&#34;;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	*envp = (uintptr_t)env;
</span><span class="cm">	return NULL;
</span><span class="cm">}
</span><span class="cm">
</span><span class="cm">static char *
</span><span class="cm">_checkException(uintptr_t jnienv) {
</span><span class="cm">	jthrowable exc;
</span><span class="cm">	JNIEnv* env = (JNIEnv*)jnienv;
</span><span class="cm">	if (!(*env)-&gt;ExceptionCheck(env)) {
</span><span class="cm">		return NULL;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	exc = (*env)-&gt;ExceptionOccurred(env);
</span><span class="cm">	(*env)-&gt;ExceptionClear(env);
</span><span class="cm">
</span><span class="cm">	jclass clazz = (*env)-&gt;FindClass(env, &#34;java/lang/Throwable&#34;);
</span><span class="cm">	jmethodID toString = (*env)-&gt;GetMethodID(env, clazz, &#34;toString&#34;, &#34;()Ljava/lang/String;&#34;);
</span><span class="cm">	jobject msgStr = (*env)-&gt;CallObjectMethod(env, exc, toString);
</span><span class="cm">	return (char*)(*env)-&gt;GetStringUTFChars(env, msgStr, 0);
</span><span class="cm">}
</span><span class="cm">
</span><span class="cm">void
</span><span class="cm">_unlockJNI() {
</span><span class="cm">	(*current_vm)-&gt;DetachCurrentThread(current_vm);
</span><span class="cm">}
</span><span class="cm">*/</span>
<span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;errors&#34;</span>
	<span class="s">&#34;runtime&#34;</span>
	<span class="s">&#34;unsafe&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">RunOnJVM</span><span class="p">(</span><span class="nx">fn</span> <span class="kd">func</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nx">ctx</span> <span class="kt">uintptr</span><span class="p">)</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">errch</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">error</span><span class="p">)</span>
	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">runtime</span><span class="p">.</span><span class="nf">LockOSThread</span><span class="p">()</span>
		<span class="k">defer</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">UnlockOSThread</span><span class="p">()</span>

		<span class="nx">env</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">uintptr_t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="nx">attached</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">errStr</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">_lockJNI</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">env</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">attached</span><span class="p">);</span> <span class="nx">errStr</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">errch</span> <span class="o">&lt;-</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">errStr</span><span class="p">))</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="nx">attached</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="k">defer</span> <span class="nx">C</span><span class="p">.</span><span class="nf">_unlockJNI</span><span class="p">()</span>
		<span class="p">}</span>

		<span class="nx">vm</span> <span class="o">:=</span> <span class="nb">uintptr</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">current_vm</span><span class="p">))</span> <span class="c1">// #nosec
</span><span class="c1"></span>		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">fn</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nb">uintptr</span><span class="p">(</span><span class="nx">env</span><span class="p">),</span> <span class="nb">uintptr</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">current_ctx</span><span class="p">));</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">errch</span> <span class="o">&lt;-</span> <span class="nx">err</span>
			<span class="k">return</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">exc</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">_checkException</span><span class="p">(</span><span class="nx">env</span><span class="p">);</span> <span class="nx">exc</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">errch</span> <span class="o">&lt;-</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">exc</span><span class="p">))</span>
			<span class="nx">C</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">exc</span><span class="p">))</span> <span class="c1">// #nosec
</span><span class="c1"></span>			<span class="k">return</span>
		<span class="p">}</span>
		<span class="nx">errch</span> <span class="o">&lt;-</span> <span class="kc">nil</span>
	<span class="p">}()</span>
	<span class="k">return</span> <span class="o">&lt;-</span><span class="nx">errch</span>
<span class="p">}</span>
</code></pre></div><h3 id="上記-jni-パッケージを使ってファイル保存領域を取得するメソッド-go言語--c言語">上記 jni パッケージを使ってファイル保存領域を取得するメソッド (Go言語 + C言語)</h3>
<p>上記 jni パッケージを使って、ファイル保存領域を取得するための関数を jni 上で実行する。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// +build android
</span><span class="c1"></span>
<span class="kn">package</span> <span class="nx">storage</span>

<span class="cm">/*
</span><span class="cm">#include &lt;jni.h&gt;
</span><span class="cm">#include &lt;stdlib.h&gt;
</span><span class="cm">
</span><span class="cm">static const char *
</span><span class="cm">getFilesDir(uintptr_t java_vm, uintptr_t jni_env, uintptr_t jni_ctx) {
</span><span class="cm">	JNIEnv* env = (JNIEnv*)jni_env;
</span><span class="cm">	jobject ctx = (jobject)jni_ctx;
</span><span class="cm">
</span><span class="cm">	jclass context = (*env)-&gt;FindClass(env, &#34;android/content/Context&#34;);
</span><span class="cm">	if(context == NULL) {
</span><span class="cm">		return NULL;
</span><span class="cm">	}
</span><span class="cm">	jmethodID getFilesDir = (*env)-&gt;GetMethodID(env, context, &#34;getFilesDir&#34;, &#34;()Ljava/io/File;&#34;);
</span><span class="cm">	if(getFilesDir == NULL){
</span><span class="cm">		return NULL;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	jobject f = (*env)-&gt;CallObjectMethod(env, ctx, getFilesDir);
</span><span class="cm">	if (f == NULL) {
</span><span class="cm">		return NULL;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	jclass file = (*env)-&gt;FindClass(env, &#34;java/io/File&#34;);
</span><span class="cm">	if (file == NULL) {
</span><span class="cm">		return NULL;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	jmethodID getAbsolutePath = (*env)-&gt;GetMethodID(env, file, &#34;getAbsolutePath&#34;, &#34;()Ljava/lang/String;&#34;);
</span><span class="cm">	if (getAbsolutePath == NULL) {
</span><span class="cm">		return NULL;
</span><span class="cm">	}
</span><span class="cm">
</span><span class="cm">	jstring path = (jstring)(*env)-&gt;CallObjectMethod(env, f, getAbsolutePath);
</span><span class="cm">	return (*env)-&gt;GetStringUTFChars(env, path, 0);
</span><span class="cm">}
</span><span class="cm">*/</span>
<span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;unsafe&#34;</span>

	<span class="s">&#34;github.com/pankona/gomo-simra/simra/internal/jni&#34;</span>
	<span class="s">&#34;github.com/pankona/gomo-simra/simra/simlog&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">storageAndroid</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nf">NewStorage</span><span class="p">()</span> <span class="nx">Storager</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">storageAndroid</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">path</span> <span class="kt">string</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">storageAndroid</span><span class="p">)</span> <span class="nf">DirectoryPath</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">path</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">path</span>
	<span class="p">}</span>
	<span class="nx">jni</span><span class="p">.</span><span class="nf">RunOnJVM</span><span class="p">(</span>
		<span class="kd">func</span><span class="p">(</span><span class="nx">vm</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nx">ctx</span> <span class="kt">uintptr</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
			<span class="nx">cpath</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">getFilesDir</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nf">uintptr_t</span><span class="p">(</span><span class="nx">vm</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nf">uintptr_t</span><span class="p">(</span><span class="nx">env</span><span class="p">),</span> <span class="nx">C</span><span class="p">.</span><span class="nf">uintptr_t</span><span class="p">(</span><span class="nx">ctx</span><span class="p">))</span>
			<span class="k">if</span> <span class="nx">cpath</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">simlog</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;failed to get FilesDir!&#34;</span><span class="p">)</span>
			<span class="p">}</span>
			<span class="nx">path</span> <span class="p">=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">GoString</span><span class="p">(</span><span class="nx">cpath</span><span class="p">)</span>
			<span class="nx">C</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span><span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span><span class="nx">cpath</span><span class="p">))</span> <span class="c1">// #nosec
</span><span class="c1"></span>			<span class="k">return</span> <span class="kc">nil</span>
		<span class="p">})</span>
	<span class="k">return</span> <span class="nx">path</span>
<span class="p">}</span>
</code></pre></div><h3 id="directorypath-を呼び出す部分-go言語">DirectoryPath() を呼び出す部分 (Go言語)</h3>
<p>上記で準備した関数を呼び出す部分。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dir</span> <span class="o">:=</span> <span class="nx">storage</span><span class="p">.</span><span class="nf">NewStorage</span><span class="p">().</span><span class="nf">DirectoryPath</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;path to internal storage: %s&#34;</span><span class="p">,</span> <span class="nx">dir</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>これで、ファイル保存領域へのディレクトリパスを取得できる。<br>
あとは、取得したディレクトリパス配下に保存したいものを保存する。</p>
<h2 id="余談-キャッシュディレクトリの取得">(余談) キャッシュディレクトリの取得</h2>
<p>上記のコードで永続保存が可能な領域へのパスが取得できるので、それはそれで良いのであるが、<br>
実はもっと手軽にファイル保存が可能な領域へのパスを取得できる方法があり、<br>
それは環境変数 <code>TMPDIR</code> を参照することである。</p>
<p>ただし、本値は Android SDK の API で言うところの <code>Context.getCacheDir</code> に相当し、<br>
Android 端末の状況によっては削除され得る領域であることに気をつける必要がある。<br>
が、ちょっと保存したいくらいの用途であれば耐えうるような気がする。<br>
以下のようにして取得する。</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dir</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;TMPDIR&#34;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;path to internal storage (for cache): %s&#34;</span><span class="p">,</span> <span class="nx">dir</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 1 of 3</span>
    
      <a href="/posts/page/2/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://pankona.github.io/js/all.min.js"></script>
<script type="text/javascript" src="https://pankona.github.io/js/jquery.oembed.js"></script>
<script>
$(function(){
    $("a.embed").oembed();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pankona.github.io/css/jquery.oembed.css"> 

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-48476608-2', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
